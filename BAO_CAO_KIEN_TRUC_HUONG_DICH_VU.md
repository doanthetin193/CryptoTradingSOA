# BÃO CÃO MÃ”N Há»ŒC
# KIáº¾N TRÃšC HÆ¯á»šNG Dá»ŠCH Vá»¤ (SOA)

## Äá»€ TÃ€I: Há»† THá»NG GIAO Dá»ŠCH TIá»€N ÄIá»†N Tá»¬ (CryptoTrading)

---

**Sinh viÃªn thá»±c hiá»‡n:** [Há» tÃªn sinh viÃªn]  
**MSSV:** [MÃ£ sá»‘ sinh viÃªn]  
**Lá»›p:** [TÃªn lá»›p]  
**Giáº£ng viÃªn hÆ°á»›ng dáº«n:** [TÃªn giáº£ng viÃªn]

---

# Má»¤C Lá»¤C

1. [BÃ i toÃ¡n](#1-bÃ i-toÃ¡n)
2. [PhÃ¢n tÃ­ch chá»©c nÄƒng cá»§a há»‡ thá»‘ng](#2-phÃ¢n-tÃ­ch-chá»©c-nÄƒng-cá»§a-há»‡-thá»‘ng)
3. [PhÃ¢n rÃ£ chá»©c nÄƒng con (dá»‹ch vá»¥)](#3-phÃ¢n-rÃ£-chá»©c-nÄƒng-con-dá»‹ch-vá»¥)
4. [PhÃ¢n tÃ­ch vÃ  thiáº¿t káº¿ dá»¯ liá»‡u](#4-phÃ¢n-tÃ­ch-vÃ -thiáº¿t-káº¿-dá»¯-liá»‡u)
5. [Giao diá»‡n cá»§a há»‡ thá»‘ng](#5-giao-diá»‡n-cá»§a-há»‡-thá»‘ng)
6. [Káº¿t luáº­n](#6-káº¿t-luáº­n)

---

# 1. BÃ€I TOÃN

## 1.1. PhÃ¡t biá»ƒu bÃ i toÃ¡n

Trong bá»‘i cáº£nh thá»‹ trÆ°á»ng tiá»n Ä‘iá»‡n tá»­ (cryptocurrency) ngÃ y cÃ ng phÃ¡t triá»ƒn máº¡nh máº½ trÃªn toÃ n cáº§u, nhu cáº§u vá» cÃ¡c ná»n táº£ng giao dá»‹ch tiá»n Ä‘iá»‡n tá»­ an toÃ n, nhanh chÃ³ng vÃ  dá»… sá»­ dá»¥ng ngÃ y cÃ ng tÄƒng cao. Tuy nhiÃªn, cÃ¡c ná»n táº£ng giao dá»‹ch hiá»‡n táº¡i gáº·p pháº£i má»™t sá»‘ váº¥n Ä‘á»:

**CÃ¡c váº¥n Ä‘á» hiá»‡n táº¡i:**

1. **Há»‡ thá»‘ng monolithic khÃ³ má»Ÿ rá»™ng:** CÃ¡c há»‡ thá»‘ng giao dá»‹ch truyá»n thá»‘ng thÆ°á»ng Ä‘Æ°á»£c xÃ¢y dá»±ng theo kiáº¿n trÃºc monolithic, khiáº¿n viá»‡c má»Ÿ rá»™ng quy mÃ´ khi lÆ°á»£ng ngÆ°á»i dÃ¹ng tÄƒng cao trá»Ÿ nÃªn khÃ³ khÄƒn vÃ  tá»‘n kÃ©m.

2. **KhÃ³ khÄƒn trong báº£o trÃ¬ vÃ  cáº­p nháº­t:** Khi toÃ n bá»™ logic nghiá»‡p vá»¥ náº±m trong má»™t á»©ng dá»¥ng duy nháº¥t, viá»‡c sá»­a lá»—i hoáº·c thÃªm tÃ­nh nÄƒng má»›i cÃ³ thá»ƒ áº£nh hÆ°á»Ÿng Ä‘áº¿n toÃ n bá»™ há»‡ thá»‘ng.

3. **Single point of failure:** Náº¿u má»™t pháº§n cá»§a há»‡ thá»‘ng gáº·p sá»± cá»‘, toÃ n bá»™ á»©ng dá»¥ng cÃ³ thá»ƒ ngá»«ng hoáº¡t Ä‘á»™ng.

4. **KhÃ³ tÃ­ch há»£p vá»›i cÃ¡c dá»‹ch vá»¥ bÃªn thá»© ba:** Viá»‡c káº¿t ná»‘i vá»›i cÃ¡c API cung cáº¥p giÃ¡ coin, dá»‹ch vá»¥ thanh toÃ¡n, hoáº·c há»‡ thá»‘ng thÃ´ng bÃ¡o trá»Ÿ nÃªn phá»©c táº¡p.

**Giáº£i phÃ¡p Ä‘á» xuáº¥t:**

XÃ¢y dá»±ng má»™t há»‡ thá»‘ng giao dá»‹ch tiá»n Ä‘iá»‡n tá»­ mÃ´ phá»ng (paper trading) theo **kiáº¿n trÃºc hÆ°á»›ng dá»‹ch vá»¥ (SOA - Service-Oriented Architecture)**, trong Ä‘Ã³:

- Há»‡ thá»‘ng Ä‘Æ°á»£c chia thÃ nh cÃ¡c dá»‹ch vá»¥ Ä‘á»™c láº­p (services), má»—i dá»‹ch vá»¥ Ä‘áº£m nhiá»‡m má»™t chá»©c nÄƒng nghiá»‡p vá»¥ cá»¥ thá»ƒ.
- CÃ¡c dá»‹ch vá»¥ giao tiáº¿p vá»›i nhau thÃ´ng qua API Gateway.
- Há»‡ thá»‘ng cÃ³ kháº£ nÄƒng má»Ÿ rá»™ng linh hoáº¡t, dá»… báº£o trÃ¬ vÃ  cÃ³ tÃ­nh sáºµn sÃ ng cao.

**Pháº¡m vi bÃ i toÃ¡n:**

- Há»‡ thá»‘ng cho phÃ©p ngÆ°á»i dÃ¹ng Ä‘Äƒng kÃ½, Ä‘Äƒng nháº­p vÃ  quáº£n lÃ½ tÃ i khoáº£n.
- NgÆ°á»i dÃ¹ng Ä‘Æ°á»£c cáº¥p sá»‘ dÆ° áº£o (1000 USDT) Ä‘á»ƒ thá»±c hiá»‡n giao dá»‹ch mua/bÃ¡n coin.
- Há»‡ thá»‘ng hiá»ƒn thá»‹ giÃ¡ coin real-time tá»« API bÃªn ngoÃ i (CoinGecko).
- NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ xem danh má»¥c Ä‘áº§u tÆ°, lá»‹ch sá»­ giao dá»‹ch vÃ  lÃ£i/lá»—.
- Há»‡ thá»‘ng há»— trá»£ thÃ´ng bÃ¡o vÃ  cáº£nh bÃ¡o giÃ¡.
- CÃ³ chá»©c nÄƒng quáº£n trá»‹ viÃªn (Admin) Ä‘á»ƒ quáº£n lÃ½ ngÆ°á»i dÃ¹ng.

---

# 2. PHÃ‚N TÃCH CHá»¨C NÄ‚NG Cá»¦A Há»† THá»NG

## 2.1. XÃ¡c Ä‘á»‹nh má»¥c tiÃªu cá»§a há»‡ thá»‘ng

### Má»¥c tiÃªu tá»•ng quÃ¡t:

XÃ¢y dá»±ng má»™t ná»n táº£ng giao dá»‹ch tiá»n Ä‘iá»‡n tá»­ mÃ´ phá»ng theo kiáº¿n trÃºc hÆ°á»›ng dá»‹ch vá»¥, cho phÃ©p ngÆ°á»i dÃ¹ng tráº£i nghiá»‡m viá»‡c mua bÃ¡n coin mÃ  khÃ´ng cáº§n sá»­ dá»¥ng tiá»n tháº­t.

### Má»¥c tiÃªu cá»¥ thá»ƒ:

| STT | Má»¥c tiÃªu | MÃ´ táº£ |
|-----|----------|-------|
| 1 | **Quáº£n lÃ½ ngÆ°á»i dÃ¹ng** | Cho phÃ©p Ä‘Äƒng kÃ½, Ä‘Äƒng nháº­p, quáº£n lÃ½ profile vÃ  sá»‘ dÆ° áº£o |
| 2 | **Cung cáº¥p dá»¯ liá»‡u thá»‹ trÆ°á»ng** | Hiá»ƒn thá»‹ giÃ¡ coin real-time, biá»ƒu Ä‘á»“ lá»‹ch sá»­ giÃ¡ |
| 3 | **Thá»±c hiá»‡n giao dá»‹ch** | Cho phÃ©p mua/bÃ¡n coin vá»›i giÃ¡ thá»±c táº¿ tá»« thá»‹ trÆ°á»ng |
| 4 | **Quáº£n lÃ½ danh má»¥c Ä‘áº§u tÆ°** | Theo dÃµi holdings, tÃ­nh toÃ¡n lÃ£i/lá»— theo thá»i gian thá»±c |
| 5 | **Ghi nháº­n lá»‹ch sá»­** | LÆ°u trá»¯ vÃ  hiá»ƒn thá»‹ lá»‹ch sá»­ táº¥t cáº£ giao dá»‹ch |
| 6 | **ThÃ´ng bÃ¡o ngÆ°á»i dÃ¹ng** | Gá»­i thÃ´ng bÃ¡o giao dá»‹ch, cáº£nh bÃ¡o giÃ¡ |
| 7 | **Quáº£n trá»‹ há»‡ thá»‘ng** | Cho phÃ©p admin quáº£n lÃ½ users, xem thá»‘ng kÃª |

## 2.2. YÃªu cáº§u chá»©c nÄƒng vÃ  phi chá»©c nÄƒng

### 2.2.1. YÃªu cáº§u chá»©c nÄƒng (Functional Requirements)

**A. Chá»©c nÄƒng xÃ¡c thá»±c vÃ  ngÆ°á»i dÃ¹ng:**

| ID | Chá»©c nÄƒng | MÃ´ táº£ chi tiáº¿t |
|----|-----------|----------------|
| FR01 | ÄÄƒng kÃ½ tÃ i khoáº£n | NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ táº¡o tÃ i khoáº£n vá»›i email, máº­t kháº©u vÃ  há» tÃªn |
| FR02 | ÄÄƒng nháº­p | XÃ¡c thá»±c báº±ng email vÃ  máº­t kháº©u, nháº­n JWT token |
| FR03 | Xem profile | Hiá»ƒn thá»‹ thÃ´ng tin cÃ¡ nhÃ¢n vÃ  sá»‘ dÆ° hiá»‡n táº¡i |
| FR04 | Cáº­p nháº­t profile | Cho phÃ©p thay Ä‘á»•i há» tÃªn |
| FR05 | Xem lá»‹ch sá»­ sá»‘ dÆ° | Hiá»ƒn thá»‹ biáº¿n Ä‘á»™ng sá»‘ dÆ° theo thá»i gian |

**B. Chá»©c nÄƒng thá»‹ trÆ°á»ng:**

| ID | Chá»©c nÄƒng | MÃ´ táº£ chi tiáº¿t |
|----|-----------|----------------|
| FR06 | Xem giÃ¡ táº¥t cáº£ coins | Hiá»ƒn thá»‹ danh sÃ¡ch coin vá»›i giÃ¡ hiá»‡n táº¡i vÃ  biáº¿n Ä‘á»™ng 24h |
| FR07 | Xem chi tiáº¿t coin | Hiá»ƒn thá»‹ thÃ´ng tin chi tiáº¿t vÃ  biá»ƒu Ä‘á»“ giÃ¡ cá»§a má»™t coin |
| FR08 | Xem biá»ƒu Ä‘á»“ lá»‹ch sá»­ | Hiá»ƒn thá»‹ chart giÃ¡ 7 ngÃ y gáº§n nháº¥t |

**C. Chá»©c nÄƒng giao dá»‹ch:**

| ID | Chá»©c nÄƒng | MÃ´ táº£ chi tiáº¿t |
|----|-----------|----------------|
| FR09 | Mua coin | Mua coin vá»›i sá»‘ lÆ°á»£ng chá»‰ Ä‘á»‹nh, trá»« sá»‘ dÆ°, cá»™ng holdings |
| FR10 | BÃ¡n coin | BÃ¡n coin Ä‘ang sá»Ÿ há»¯u, cá»™ng sá»‘ dÆ°, giáº£m holdings |
| FR11 | Xem lá»‹ch sá»­ giao dá»‹ch | Hiá»ƒn thá»‹ danh sÃ¡ch giao dá»‹ch vá»›i bá»™ lá»c vÃ  phÃ¢n trang |

**D. Chá»©c nÄƒng danh má»¥c Ä‘áº§u tÆ°:**

| ID | Chá»©c nÄƒng | MÃ´ táº£ chi tiáº¿t |
|----|-----------|----------------|
| FR12 | Xem portfolio | Hiá»ƒn thá»‹ holdings vá»›i giÃ¡ hiá»‡n táº¡i vÃ  P&L |
| FR13 | TÃ­nh toÃ¡n lÃ£i/lá»— | Tá»± Ä‘á»™ng tÃ­nh profit dá»±a trÃªn giÃ¡ mua trung bÃ¬nh vÃ  giÃ¡ hiá»‡n táº¡i |

**E. Chá»©c nÄƒng thÃ´ng bÃ¡o:**

| ID | Chá»©c nÄƒng | MÃ´ táº£ chi tiáº¿t |
|----|-----------|----------------|
| FR14 | Xem thÃ´ng bÃ¡o | Hiá»ƒn thá»‹ danh sÃ¡ch thÃ´ng bÃ¡o |
| FR15 | ÄÃ¡nh dáº¥u Ä‘Ã£ Ä‘á»c | ÄÃ¡nh dáº¥u má»™t hoáº·c táº¥t cáº£ thÃ´ng bÃ¡o Ä‘Ã£ Ä‘á»c |
| FR16 | XÃ³a thÃ´ng bÃ¡o | XÃ³a thÃ´ng bÃ¡o khÃ´ng cáº§n thiáº¿t |
| FR17 | Táº¡o cáº£nh bÃ¡o giÃ¡ | Äáº·t alert khi coin Ä‘áº¡t giÃ¡ má»¥c tiÃªu |
| FR18 | Quáº£n lÃ½ cáº£nh bÃ¡o | Xem vÃ  xÃ³a cÃ¡c cáº£nh bÃ¡o giÃ¡ Ä‘Ã£ táº¡o |

**F. Chá»©c nÄƒng quáº£n trá»‹:**

| ID | Chá»©c nÄƒng | MÃ´ táº£ chi tiáº¿t |
|----|-----------|----------------|
| FR19 | Xem danh sÃ¡ch user | Admin xem táº¥t cáº£ ngÆ°á»i dÃ¹ng |
| FR20 | KhÃ³a/Má»Ÿ khÃ³a user | Toggle tráº¡ng thÃ¡i active cá»§a user |
| FR21 | Reset sá»‘ dÆ° user | Set láº¡i sá»‘ dÆ° vá» 1000 USDT |
| FR22 | XÃ³a user | XÃ³a tÃ i khoáº£n ngÆ°á»i dÃ¹ng |
| FR23 | Xem thá»‘ng kÃª há»‡ thá»‘ng | Xem tá»•ng user, tá»•ng sá»‘ dÆ°, v.v. |

### 2.2.2. YÃªu cáº§u phi chá»©c nÄƒng (Non-Functional Requirements)

| ID | Loáº¡i | YÃªu cáº§u | MÃ´ táº£ |
|----|------|---------|-------|
| NFR01 | **Hiá»‡u nÄƒng** | Response time < 2s | Thá»i gian pháº£n há»“i API dÆ°á»›i 2 giÃ¢y |
| NFR02 | **Hiá»‡u nÄƒng** | Concurrent users | Há»— trá»£ tá»‘i thiá»ƒu 100 ngÆ°á»i dÃ¹ng Ä‘á»“ng thá»i |
| NFR03 | **Báº£o máº­t** | JWT Authentication | XÃ¡c thá»±c ngÆ°á»i dÃ¹ng báº±ng JSON Web Token |
| NFR04 | **Báº£o máº­t** | Password hashing | MÃ£ hÃ³a máº­t kháº©u báº±ng bcrypt |
| NFR05 | **Báº£o máº­t** | Rate limiting | Giá»›i háº¡n request Ä‘á»ƒ chá»‘ng DDoS |
| NFR06 | **Kháº£ dá»¥ng** | 99% uptime | Há»‡ thá»‘ng hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh |
| NFR07 | **Kháº£ dá»¥ng** | Circuit Breaker | Tá»± Ä‘á»™ng ngáº¯t káº¿t ná»‘i khi service lá»—i |
| NFR08 | **Má»Ÿ rá»™ng** | Horizontal scaling | CÃ³ thá»ƒ má»Ÿ rá»™ng tá»«ng service Ä‘á»™c láº­p |
| NFR09 | **Báº£o trÃ¬** | Loose coupling | CÃ¡c service Ã­t phá»¥ thuá»™c láº«n nhau |
| NFR10 | **Real-time** | WebSocket | Cáº­p nháº­t dá»¯ liá»‡u real-time |

## 2.3. Biá»ƒu Ä‘á»“ chá»©c nÄƒng

**Biá»ƒu Ä‘á»“ Use Case tá»•ng quan há»‡ thá»‘ng:**

```mermaid
flowchart LR
    User((ğŸ‘¤ User))
    Admin((ğŸ‘‘ Admin))

    User --> A[XÃ¡c thá»±c<br/>ÄÄƒng kÃ½/ÄÄƒng nháº­p]
    User --> B[Thá»‹ trÆ°á»ng<br/>GiÃ¡ coin, Biá»ƒu Ä‘á»“]
    User --> C[Giao dá»‹ch<br/>Mua/BÃ¡n coin]
    User --> D[Portfolio<br/>Danh má»¥c Ä‘áº§u tÆ°]
    User --> E[ThÃ´ng bÃ¡o<br/>Cáº£nh bÃ¡o giÃ¡]

    Admin -.->|extends| User
    Admin --> F[Quáº£n trá»‹ Users<br/>Xem, KhÃ³a, XÃ³a]
    Admin --> G[Quáº£n trá»‹ Balance<br/>Äiá»u chá»‰nh sá»‘ dÆ°]
    Admin --> H[Thá»‘ng kÃª<br/>Xem stats há»‡ thá»‘ng]
```

**ChÃº thÃ­ch:**
- **User**: NgÆ°á»i dÃ¹ng thÃ´ng thÆ°á»ng
- **Admin**: Káº¿ thá»«a táº¥t cáº£ quyá»n cá»§a User (mÅ©i tÃªn Ä‘á»©t `extends`) + cÃ³ thÃªm cÃ¡c chá»©c nÄƒng quáº£n trá»‹
- Admin cÃ³ thá»ƒ: trade, xem portfolio, thÃ´ng bÃ¡o... nhÆ° User + quáº£n lÃ½ users, Ä‘iá»u chá»‰nh balance

**Chi tiáº¿t cÃ¡c nhÃ³m Use Case:**

| NhÃ³m | Use Cases | Service | Actor |
|------|-----------|---------|-------|
| **XÃ¡c thá»±c** | ÄÄƒng kÃ½, ÄÄƒng nháº­p, Profile, Sá»‘ dÆ° | User Service | User, Admin |
| **Thá»‹ trÆ°á»ng** | GiÃ¡ coins, Chi tiáº¿t coin, Biá»ƒu Ä‘á»“ | Market Service | User, Admin |
| **Giao dá»‹ch** | Mua coin, BÃ¡n coin, Lá»‹ch sá»­ | Trade Orchestration | User, Admin |
| **Portfolio** | Xem holdings, TÃ­nh P&L | Portfolio Service | User, Admin |
| **ThÃ´ng bÃ¡o** | Xem/XÃ³a thÃ´ng bÃ¡o, Cáº£nh bÃ¡o giÃ¡ | Notification Service | User, Admin |
| **Quáº£n trá»‹ Users** | Xem danh sÃ¡ch, KhÃ³a/Má»Ÿ khÃ³a, XÃ³a | User Service | **Admin only** |
| **Quáº£n trá»‹ Balance** | Äiá»u chá»‰nh sá»‘ dÆ° user | User Service | **Admin only** |
| **Thá»‘ng kÃª** | Xem thá»‘ng kÃª há»‡ thá»‘ng | User Service | **Admin only** |

---

# 3. PHÃ‚N RÃƒ CHá»¨C NÄ‚NG CON (Dá»ŠCH Vá»¤)

## 3.1. NguyÃªn táº¯c phÃ¢n rÃ£

Há»‡ thá»‘ng Ä‘Æ°á»£c phÃ¢n rÃ£ theo nguyÃªn táº¯c **Single Responsibility Principle (SRP)** - má»—i dá»‹ch vá»¥ chá»‰ Ä‘áº£m nhiá»‡m má»™t trÃ¡ch nhiá»‡m nghiá»‡p vá»¥ duy nháº¥t.

**CÃ¡c dá»‹ch vá»¥ Ä‘Æ°á»£c phÃ¢n rÃ£:**

| STT | Dá»‹ch vá»¥ | Port | TrÃ¡ch nhiá»‡m chÃ­nh |
|-----|---------|------|-------------------|
| 0 | **API Gateway** | 3000 | Äá»‹nh tuyáº¿n, xÃ¡c thá»±c, orchestration |
| 1 | **User Service** | 3001 | XÃ¡c thá»±c, quáº£n lÃ½ ngÆ°á»i dÃ¹ng, sá»‘ dÆ° |
| 2 | **Market Service** | 3002 | Dá»¯ liá»‡u giÃ¡ coin tá»« API bÃªn ngoÃ i |
| 3 | **Portfolio Service** | 3003 | Quáº£n lÃ½ danh má»¥c Ä‘áº§u tÆ° |
| 4 | **Trade Service** | 3004 | Ghi nháº­n lá»‹ch sá»­ giao dá»‹ch |
| 5 | **Notification Service** | 3005 | ThÃ´ng bÃ¡o vÃ  cáº£nh bÃ¡o giÃ¡ |

**SÆ¡ Ä‘á»“ kiáº¿n trÃºc há»‡ thá»‘ng SOA:**

```mermaid
flowchart TB
    subgraph Client["ğŸ–¥ï¸ Client Layer"]
        FE[React Frontend<br/>Port 5173]
    end

    subgraph Gateway["ğŸšª API Gateway Layer"]
        GW[API Gateway<br/>Port 3000<br/>Routing, Auth, Rate Limiting]
    end

    subgraph Services["âš™ï¸ Service Layer"]
        US[User Service<br/>Port 3001]
        MS[Market Service<br/>Port 3002]
        PS[Portfolio Service<br/>Port 3003]
        TS[Trade Service<br/>Port 3004]
        NS[Notification Service<br/>Port 3005]
    end

    subgraph External["ğŸŒ External"]
        CG[CoinGecko API]
    end

    subgraph Data["ğŸ’¾ Shared Database"]
        DB[(MongoDB<br/>Shared Database)]
    end

    subgraph Discovery["ğŸ” Service Discovery"]
        CS[Consul]
    end

    FE <-->|HTTP/WebSocket| GW
    GW <--> US
    GW <--> MS
    GW <--> PS
    GW <--> TS
    GW <--> NS
    
    MS <-->|API Call| CG
    
    US --> DB
    PS --> DB
    TS --> DB
    NS --> DB

    US -.->|Register| CS
    MS -.->|Register| CS
    PS -.->|Register| CS
    TS -.->|Register| CS
    NS -.->|Register| CS
    GW -.->|Discover| CS
```

**Äáº·c Ä‘iá»ƒm kiáº¿n trÃºc SOA:**

| Äáº·c Ä‘iá»ƒm | MÃ´ táº£ |
|----------|-------|
| **Shared Database** | Táº¥t cáº£ services káº¿t ná»‘i cÃ¹ng má»™t MongoDB instance |
| **Service Discovery** | Consul quáº£n lÃ½ Ä‘Äƒng kÃ½ vÃ  khÃ¡m phÃ¡ services |
| **API Gateway** | Single entry point, xá»­ lÃ½ routing vÃ  authentication |
| **Loose Coupling** | Services giao tiáº¿p qua HTTP REST APIs |
| **Orchestration** | API Gateway Ä‘iá»u phá»‘i giao dá»‹ch Buy/Sell |

## 3.2. MÃ´ táº£ chi tiáº¿t tá»«ng dá»‹ch vá»¥

### 3.2.1. API Gateway

**Má»¥c Ä‘Ã­ch:** LÃ  Ä‘iá»ƒm vÃ o duy nháº¥t (single entry point) cho táº¥t cáº£ cÃ¡c request tá»« client.

**Chá»©c nÄƒng chÃ­nh:**

| Chá»©c nÄƒng | MÃ´ táº£ |
|-----------|-------|
| **Routing** | Äá»‹nh tuyáº¿n request Ä‘áº¿n Ä‘Ãºng service |
| **Authentication** | XÃ¡c thá»±c JWT token |
| **Rate Limiting** | Giá»›i háº¡n sá»‘ request (1000/15 phÃºt) |
| **Orchestration** | Äiá»u phá»‘i cÃ¡c service cho giao dá»‹ch buy/sell |
| **WebSocket** | Quáº£n lÃ½ káº¿t ná»‘i real-time |

**CÃ´ng nghá»‡:** Express.js, http-proxy-middleware, Socket.IO

---

### 3.2.2. User Service

**Má»¥c Ä‘Ã­ch:** Quáº£n lÃ½ toÃ n bá»™ thÃ´ng tin ngÆ°á»i dÃ¹ng vÃ  xÃ¡c thá»±c.

**Endpoints:**

| Method | Endpoint | MÃ´ táº£ |
|--------|----------|-------|
| POST | /register | ÄÄƒng kÃ½ tÃ i khoáº£n má»›i |
| POST | /login | ÄÄƒng nháº­p, nháº­n JWT token |
| GET | /profile | Láº¥y thÃ´ng tin profile |
| PUT | /profile | Cáº­p nháº­t profile |
| GET | /balance | Láº¥y sá»‘ dÆ° hiá»‡n táº¡i |
| PUT | /balance | Cáº­p nháº­t sá»‘ dÆ° (internal) |
| GET | /admin/users | [Admin] Danh sÃ¡ch users |
| GET | /admin/stats | [Admin] Thá»‘ng kÃª há»‡ thá»‘ng |
| PUT | /admin/users/:id/toggle | [Admin] KhÃ³a/Má»Ÿ khÃ³a user |
| PUT | /admin/users/:id/balance | [Admin] Reset sá»‘ dÆ° |
| DELETE | /admin/users/:id | [Admin] XÃ³a user |

**Database:** MongoDB - Collection `users`

**CÃ´ng nghá»‡:** Express.js, bcryptjs, jsonwebtoken, Mongoose

---

### 3.2.3. Market Service

**Má»¥c Ä‘Ã­ch:** Cung cáº¥p dá»¯ liá»‡u giÃ¡ coin real-time tá»« API bÃªn ngoÃ i.

**Endpoints:**

| Method | Endpoint | MÃ´ táº£ |
|--------|----------|-------|
| GET | /prices | GiÃ¡ táº¥t cáº£ coins há»— trá»£ |
| GET | /price/:coinId | GiÃ¡ chi tiáº¿t má»™t coin |
| GET | /chart/:coinId | Dá»¯ liá»‡u biá»ƒu Ä‘á»“ 7 ngÃ y |

**Nguá»“n dá»¯ liá»‡u:** CoinGecko API (Primary), CoinPaprika API (Fallback)

**Caching:** NodeCache vá»›i TTL 2 phÃºt Ä‘á»ƒ giáº£m API calls

**CÃ´ng nghá»‡:** Express.js, axios, node-cache

---

### 3.2.4. Portfolio Service

**Má»¥c Ä‘Ã­ch:** Quáº£n lÃ½ danh má»¥c Ä‘áº§u tÆ° cá»§a ngÆ°á»i dÃ¹ng.

**Endpoints:**

| Method | Endpoint | MÃ´ táº£ |
|--------|----------|-------|
| GET | / | Láº¥y portfolio cá»§a user |
| POST | /holding | ThÃªm coin vÃ o portfolio (internal) |
| PUT | /holding | Giáº£m/XÃ³a coin khá»i portfolio (internal) |

**Logic nghiá»‡p vá»¥:**

- **DCA (Dollar Cost Averaging):** Khi mua thÃªm coin Ä‘Ã£ cÃ³, tÃ­nh láº¡i giÃ¡ mua trung bÃ¬nh
  ```
  averageBuyPrice = totalInvested / totalAmount
  ```

- **Profit Calculation:**
  ```
  profit = currentValue - totalInvested
  profitPercentage = (profit / totalInvested) Ã— 100
  ```

**Database:** MongoDB - Collection `portfolios`

**CÃ´ng nghá»‡:** Express.js, Mongoose

---

### 3.2.5. Trade Service

**Má»¥c Ä‘Ã­ch:** Ghi nháº­n lá»‹ch sá»­ táº¥t cáº£ giao dá»‹ch.

**Endpoints:**

| Method | Endpoint | MÃ´ táº£ |
|--------|----------|-------|
| POST | / | Táº¡o record giao dá»‹ch má»›i |
| GET | /history | Lá»‹ch sá»­ giao dá»‹ch vá»›i filter |

**LÆ°u Ã½:** Trade Service KHÃ”NG thá»±c hiá»‡n logic mua/bÃ¡n. Logic Ä‘Ã³ Ä‘Æ°á»£c xá»­ lÃ½ bá»Ÿi **Trade Orchestration** á»Ÿ API Gateway.

**Database:** MongoDB - Collection `trades`

**CÃ´ng nghá»‡:** Express.js, Mongoose

---

### 3.2.6. Notification Service

**Má»¥c Ä‘Ã­ch:** Quáº£n lÃ½ thÃ´ng bÃ¡o vÃ  cáº£nh bÃ¡o giÃ¡.

**Endpoints:**

| Method | Endpoint | MÃ´ táº£ |
|--------|----------|-------|
| GET | / | Danh sÃ¡ch thÃ´ng bÃ¡o |
| GET | /unread-count | Sá»‘ thÃ´ng bÃ¡o chÆ°a Ä‘á»c |
| POST | /send | Gá»­i thÃ´ng bÃ¡o (internal) |
| PUT | /:id/read | ÄÃ¡nh dáº¥u Ä‘Ã£ Ä‘á»c |
| PUT | /read-all | ÄÃ¡nh dáº¥u táº¥t cáº£ Ä‘Ã£ Ä‘á»c |
| DELETE | /:id | XÃ³a thÃ´ng bÃ¡o |
| POST | /alert | Táº¡o cáº£nh bÃ¡o giÃ¡ |
| GET | /alerts | Danh sÃ¡ch cáº£nh bÃ¡o |
| DELETE | /alert/:id | XÃ³a cáº£nh bÃ¡o |

**Cron Job:** Kiá»ƒm tra giÃ¡ má»—i 1 phÃºt, trigger alert khi Ä‘áº¡t Ä‘iá»u kiá»‡n

**Database:** MongoDB - Collections `notifications`, `pricealerts`

**CÃ´ng nghá»‡:** Express.js, Mongoose, node-cron

---

## 3.3. Trade Orchestration (Chi tiáº¿t)

**Má»¥c Ä‘Ã­ch:** Äiá»u phá»‘i nhiá»u services Ä‘á»ƒ thá»±c hiá»‡n má»™t giao dá»‹ch hoÃ n chá»‰nh.

### 3.3.1. Luá»“ng mua coin (Buy Flow)

```
BÆ¯á»šC 1: Láº¥y giÃ¡ hiá»‡n táº¡i tá»« Market Service
        â†’ TÃ­nh toÃ¡n: totalCost = amount Ã— price
        â†’ TÃ­nh phÃ­: fee = totalCost Ã— 0.1%
        â†’ finalCost = totalCost + fee

BÆ¯á»šC 2: Kiá»ƒm tra sá»‘ dÆ° tá»« User Service
        â†’ Náº¿u balance < finalCost â†’ BÃ¡o lá»—i

BÆ¯á»šC 3: Trá»« sá»‘ dÆ° (User Service)
        â†’ balance = balance - finalCost
        â†’ LÆ°u transactionState.balanceDeducted = true

BÆ¯á»šC 4: ThÃªm vÃ o portfolio (Portfolio Service)
        â†’ Náº¿u Ä‘Ã£ cÃ³ coin: tÃ­nh DCA
        â†’ Náº¿u chÆ°a cÃ³: táº¡o má»›i
        â†’ LÆ°u transactionState.holdingAdded = true

BÆ¯á»šC 5: Ghi lá»‹ch sá»­ (Trade Service)
        â†’ Táº¡o trade record

BÆ¯á»šC 6: Gá»­i thÃ´ng bÃ¡o (Notification Service)
        â†’ Táº¡o notification "Mua thÃ nh cÃ´ng"

BÆ¯á»šC 7: PhÃ¡t WebSocket event
        â†’ Emit 'trade_confirmation' cho user

Náº¾U Lá»–I: ROLLBACK
        â†’ Náº¿u holdingAdded: XÃ³a holding
        â†’ Náº¿u balanceDeducted: HoÃ n tiá»n
```

**Sequence Diagram - Buy Flow:**

```mermaid
sequenceDiagram
    participant C as Client
    participant GW as API Gateway
    participant MS as Market Service
    participant US as User Service
    participant PS as Portfolio Service
    participant TS as Trade Service
    participant NS as Notification Service

    C->>GW: POST /trade/buy {symbol, amount}
    GW->>MS: GET /price/:coinId
    MS-->>GW: {price, name}
    
    Note over GW: TÃ­nh: totalCost = amount Ã— price<br/>fee = 0.1%, finalCost = totalCost + fee

    GW->>US: GET /balance
    US-->>GW: {balance}
    
    alt balance < finalCost
        GW-->>C: âŒ KhÃ´ng Ä‘á»§ sá»‘ dÆ°
    else balance >= finalCost
        GW->>US: PUT /balance (trá»« tiá»n)
        US-->>GW: âœ“ Balance updated
        
        GW->>PS: POST /holding (thÃªm coin)
        PS-->>GW: âœ“ Holding added
        
        GW->>TS: POST / (ghi lá»‹ch sá»­)
        TS-->>GW: âœ“ Trade recorded
        
        GW->>NS: POST /send (thÃ´ng bÃ¡o)
        NS-->>GW: âœ“ Notification sent
        
        GW-->>C: âœ… Mua thÃ nh cÃ´ng
    end
```

### 3.3.2. Luá»“ng bÃ¡n coin (Sell Flow)

```
BÆ¯á»šC 1: Kiá»ƒm tra portfolio (Portfolio Service)
        â†’ Náº¿u khÃ´ng Ä‘á»§ coin â†’ BÃ¡o lá»—i

BÆ¯á»šC 2: Láº¥y giÃ¡ hiá»‡n táº¡i tá»« Market Service
        â†’ TÃ­nh toÃ¡n: totalValue = amount Ã— price
        â†’ TÃ­nh phÃ­: fee = totalValue Ã— 0.1%
        â†’ finalProceeds = totalValue - fee

BÆ¯á»šC 3: Láº¥y sá»‘ dÆ° hiá»‡n táº¡i (User Service)

BÆ¯á»šC 4: Cá»™ng sá»‘ dÆ° (User Service)
        â†’ balance = balance + finalProceeds
        â†’ LÆ°u transactionState.balanceAdded = true

BÆ¯á»šC 5: Giáº£m holdings (Portfolio Service)
        â†’ Náº¿u bÃ¡n háº¿t: xÃ³a holding
        â†’ Náº¿u bÃ¡n má»™t pháº§n: giáº£m amount
        â†’ LÆ°u transactionState.holdingReduced = true

BÆ¯á»šC 6: Ghi lá»‹ch sá»­ (Trade Service)

BÆ¯á»šC 7: Gá»­i thÃ´ng bÃ¡o + WebSocket

Náº¾U Lá»–I: ROLLBACK
        â†’ Náº¿u holdingReduced: HoÃ n láº¡i holding
        â†’ Náº¿u balanceAdded: Trá»« sá»‘ dÆ°
```

**Sequence Diagram - Sell Flow:**

```mermaid
sequenceDiagram
    participant C as Client
    participant GW as API Gateway
    participant PS as Portfolio Service
    participant MS as Market Service
    participant US as User Service
    participant TS as Trade Service
    participant NS as Notification Service

    C->>GW: POST /trade/sell {symbol, amount}
    GW->>PS: GET / (kiá»ƒm tra holdings)
    PS-->>GW: {holdings}
    
    alt KhÃ´ng Ä‘á»§ coin
        GW-->>C: âŒ KhÃ´ng Ä‘á»§ coin Ä‘á»ƒ bÃ¡n
    else Äá»§ coin
        GW->>MS: GET /price/:coinId
        MS-->>GW: {price}
        
        Note over GW: TÃ­nh: totalValue = amount Ã— price<br/>fee = 0.1%, finalProceeds = totalValue - fee

        GW->>US: PUT /balance (cá»™ng tiá»n)
        US-->>GW: âœ“ Balance updated
        
        GW->>PS: PUT /holding (giáº£m coin)
        PS-->>GW: âœ“ Holding reduced
        
        GW->>TS: POST / (ghi lá»‹ch sá»­)
        TS-->>GW: âœ“ Trade recorded
        
        GW->>NS: POST /send (thÃ´ng bÃ¡o)
        NS-->>GW: âœ“ Notification sent
        
        GW-->>C: âœ… BÃ¡n thÃ nh cÃ´ng
    end
```

---

## 3.4. Biá»ƒu Ä‘á»“ luá»“ng dá»¯ liá»‡u

### 3.4.1. Luá»“ng xÃ¡c thá»±c (Authentication Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚ â”€â”€1â”€â”€â–¶  â”‚ API Gateway â”‚ â”€â”€2â”€â”€â–¶  â”‚ User Service â”‚
â”‚         â”‚         â”‚             â”‚         â”‚              â”‚
â”‚         â”‚ â—€â”€â”€4â”€â”€  â”‚             â”‚ â—€â”€â”€3â”€â”€  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. POST /login {email, password}
2. Forward to User Service
3. Verify password, generate JWT
4. Return {token, user}
```

**DFD Level 0 - Authentication:**

```mermaid
flowchart LR
    U((User)) -->|email, password| P1[1.0<br/>XÃ¡c thá»±c]
    P1 -->|query| D1[(users)]
    D1 -->|user data| P1
    P1 -->|JWT token + user info| U
```

### 3.4.2. Luá»“ng xem portfolio (Portfolio Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚ â”€â”€1â”€â”€â–¶  â”‚ API Gateway â”‚ â”€â”€2â”€â”€â–¶  â”‚ Portfolio Service â”‚
â”‚         â”‚         â”‚ (Orchestr.) â”‚         â”‚                   â”‚
â”‚         â”‚         â”‚      â”‚      â”‚ â—€â”€â”€3â”€â”€  â”‚                   â”‚
â”‚         â”‚         â”‚      â”‚      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚         â”‚         â”‚      â”‚      â”‚
â”‚         â”‚         â”‚      â–¼      â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â”‚         â”‚    â”€â”€4â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â–¶  â”‚ Market Service â”‚
â”‚         â”‚         â”‚      â”‚      â”‚         â”‚                â”‚
â”‚         â”‚         â”‚      â”‚ â—€â”€â”€5â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
â”‚         â”‚ â—€â”€â”€6â”€â”€  â”‚      â–¼      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. GET /portfolio
2. Get holdings from Portfolio Service
3. Return holdings list
4. Get current prices for each coin
5. Return prices
6. Return enriched portfolio with P&L
```

**DFD Level 0 - Portfolio:**

```mermaid
flowchart LR
    U((User)) -->|request| P1[1.0<br/>Láº¥y Portfolio]
    P1 -->|query holdings| D1[(portfolios)]
    D1 -->|holdings| P1
    P1 -->|get prices| P2[2.0<br/>Láº¥y giÃ¡]
    P2 -->|API call| E1[CoinGecko]
    E1 -->|prices| P2
    P2 -->|prices| P1
    P1 -->|portfolio + P&L| U
```

### 3.4.3. Luá»“ng giao dá»‹ch (Trade Flow)

**DFD Level 1 - Trade Flow (Buy):**

```mermaid
flowchart TB
    U((User)) -->|symbol, amount| P1[1.0 Láº¥y giÃ¡]
    P1 -->|coinId| E1[CoinGecko]
    E1 -->|price| P1
    P1 -->|price| P2[2.0 Kiá»ƒm tra sá»‘ dÆ°]
    P2 -->|userId| D1[(users)]
    D1 -->|balance| P2
    P2 -->|OK| P3[3.0 Trá»« sá»‘ dÆ°]
    P3 -->|update| D1
    P3 -->|done| P4[4.0 ThÃªm holding]
    P4 -->|insert/update| D2[(portfolios)]
    P4 -->|done| P5[5.0 Ghi lá»‹ch sá»­]
    P5 -->|insert| D3[(trades)]
    P5 -->|done| P6[6.0 Gá»­i thÃ´ng bÃ¡o]
    P6 -->|insert| D4[(notifications)]
    P6 -->|result| U
```

---

# 4. PHÃ‚N TÃCH VÃ€ THIáº¾T Káº¾ Dá»® LIá»†U

## 4.1. MÃ´ hÃ¬nh thá»±c thá»ƒ liÃªn káº¿t (ERD)

### 4.1.1. User Service - Entity: User

```mermaid
erDiagram
    USER {
        ObjectId _id PK
        String email UK
        String password
        String fullName
        Enum role
        Number balance
        Boolean isActive
        Array balanceHistory
        Date createdAt
        Date updatedAt
    }
```

**Thuá»™c tÃ­nh:**

| Thuá»™c tÃ­nh | Kiá»ƒu | RÃ ng buá»™c | MÃ´ táº£ |
|------------|------|-----------|-------|
| _id | ObjectId | PK | KhÃ³a chÃ­nh |
| email | String | Unique, Required | Email Ä‘Äƒng nháº­p |
| password | String | Required | Máº­t kháº©u Ä‘Ã£ mÃ£ hÃ³a |
| fullName | String | Required | Há» tÃªn Ä‘áº§y Ä‘á»§ |
| role | Enum | Default: 'user' | Vai trÃ²: user/admin |
| balance | Number | Default: 1000 | Sá»‘ dÆ° USDT |
| isActive | Boolean | Default: true | Tráº¡ng thÃ¡i tÃ i khoáº£n |
| balanceHistory | Array | - | Lá»‹ch sá»­ biáº¿n Ä‘á»™ng sá»‘ dÆ° |
| createdAt | Date | Auto | NgÃ y táº¡o |
| updatedAt | Date | Auto | NgÃ y cáº­p nháº­t |

---

### 4.1.2. Portfolio Service - Entity: Portfolio

```mermaid
erDiagram
    PORTFOLIO {
        ObjectId _id PK
        ObjectId userId FK
        Array holdings
        Number totalValue
        Number totalInvested
        Number totalProfit
        Number profitPercentage
    }
    HOLDING {
        String symbol
        String coinId
        String name
        Number amount
        Number averageBuyPrice
        Number totalInvested
    }
    PORTFOLIO ||--o{ HOLDING : contains
```

**Thuá»™c tÃ­nh:**

| Thuá»™c tÃ­nh | Kiá»ƒu | RÃ ng buá»™c | MÃ´ táº£ |
|------------|------|-----------|-------|
| _id | ObjectId | PK | KhÃ³a chÃ­nh |
| userId | ObjectId | FK, Unique | LiÃªn káº¿t Ä‘áº¿n User |
| holdings | Array | - | Danh sÃ¡ch coin sá»Ÿ há»¯u |
| totalValue | Number | Default: 0 | Tá»•ng giÃ¡ trá»‹ portfolio |
| totalInvested | Number | Default: 0 | Tá»•ng chi phÃ­ Ä‘áº§u tÆ° |
| totalProfit | Number | Default: 0 | Tá»•ng lÃ£i/lá»— |
| profitPercentage | Number | Default: 0 | Pháº§n trÄƒm lÃ£i/lá»— |

**Cáº¥u trÃºc Holding:**

| Thuá»™c tÃ­nh | Kiá»ƒu | MÃ´ táº£ |
|------------|------|-------|
| symbol | String | KÃ½ hiá»‡u coin (BTC, ETH) |
| coinId | String | ID coin (bitcoin, ethereum) |
| name | String | TÃªn Ä‘áº§y Ä‘á»§ |
| amount | Number | Sá»‘ lÆ°á»£ng coin |
| averageBuyPrice | Number | GiÃ¡ mua trung bÃ¬nh |
| totalInvested | Number | Tá»•ng chi phÃ­ |

---

### 4.1.3. Trade Service - Entity: Trade

```mermaid
erDiagram
    TRADE {
        ObjectId _id PK
        ObjectId userId FK
        Enum type
        String symbol
        String coinId
        String coinName
        Number amount
        Number price
        Number totalCost
        Number fee
        Enum status
        Number balanceBefore
        Number balanceAfter
        Date executedAt
    }
```

**Thuá»™c tÃ­nh:**

| Thuá»™c tÃ­nh | Kiá»ƒu | RÃ ng buá»™c | MÃ´ táº£ |
|------------|------|-----------|-------|
| _id | ObjectId | PK | KhÃ³a chÃ­nh |
| userId | ObjectId | FK, Required | LiÃªn káº¿t Ä‘áº¿n User |
| type | Enum | Required | Loáº¡i: buy/sell |
| symbol | String | Required | KÃ½ hiá»‡u coin |
| coinId | String | Required | ID coin |
| coinName | String | Required | TÃªn coin |
| amount | Number | Required | Sá»‘ lÆ°á»£ng |
| price | Number | Required | GiÃ¡ táº¡i thá»i Ä‘iá»ƒm giao dá»‹ch |
| totalCost | Number | Required | Tá»•ng giÃ¡ trá»‹ |
| fee | Number | Default: 0 | PhÃ­ giao dá»‹ch |
| feePercentage | Number | Default: 0.1 | Pháº§n trÄƒm phÃ­ |
| status | Enum | Default: 'completed' | Tráº¡ng thÃ¡i |
| balanceBefore | Number | Required | Sá»‘ dÆ° trÆ°á»›c giao dá»‹ch |
| balanceAfter | Number | Required | Sá»‘ dÆ° sau giao dá»‹ch |
| executedAt | Date | Default: now | Thá»i Ä‘iá»ƒm thá»±c hiá»‡n |

---

### 4.1.4. Notification Service - Entities

```mermaid
erDiagram
    NOTIFICATION {
        ObjectId _id PK
        ObjectId userId FK
        Enum type
        String title
        String message
        Enum status
        Enum priority
        Object data
        Date sentAt
    }
    PRICEALERT {
        ObjectId _id PK
        ObjectId userId FK
        String symbol
        String coinId
        Number targetPrice
        Enum condition
        Boolean isActive
        Boolean triggered
        Date triggeredAt
    }
```

**Entity 1: Notification**

| Thuá»™c tÃ­nh | Kiá»ƒu | MÃ´ táº£ |
|------------|------|-------|
| _id | ObjectId | KhÃ³a chÃ­nh |
| userId | ObjectId | LiÃªn káº¿t Ä‘áº¿n User |
| type | Enum | trade/price_alert/system/warning |
| title | String | TiÃªu Ä‘á» thÃ´ng bÃ¡o |
| message | String | Ná»™i dung |
| status | Enum | unread/read/archived |
| priority | Enum | low/medium/high/urgent |
| data | Object | Dá»¯ liá»‡u bá»• sung |
| sentAt | Date | Thá»i Ä‘iá»ƒm gá»­i |

**Entity 2: PriceAlert**

| Thuá»™c tÃ­nh | Kiá»ƒu | MÃ´ táº£ |
|------------|------|-------|
| _id | ObjectId | KhÃ³a chÃ­nh |
| userId | ObjectId | LiÃªn káº¿t Ä‘áº¿n User |
| symbol | String | KÃ½ hiá»‡u coin |
| coinId | String | ID coin |
| targetPrice | Number | GiÃ¡ má»¥c tiÃªu |
| condition | Enum | above/below |
| isActive | Boolean | CÃ²n hoáº¡t Ä‘á»™ng khÃ´ng |
| triggered | Boolean | ÄÃ£ trigger chÆ°a |
| triggeredAt | Date | Thá»i Ä‘iá»ƒm trigger |

---

## 4.2. MÃ´ hÃ¬nh quan há»‡

**SÆ¡ Ä‘á»“ quan há»‡ giá»¯a cÃ¡c collections:**

```mermaid
erDiagram
    USER ||--|| PORTFOLIO : has
    USER ||--o{ TRADE : makes
    USER ||--o{ NOTIFICATION : receives
    USER ||--o{ PRICEALERT : creates
    
    USER {
        ObjectId _id PK
        String email
        Number balance
    }
    PORTFOLIO {
        ObjectId _id PK
        ObjectId userId FK
    }
    TRADE {
        ObjectId _id PK
        ObjectId userId FK
    }
    NOTIFICATION {
        ObjectId _id PK
        ObjectId userId FK
    }
    PRICEALERT {
        ObjectId _id PK
        ObjectId userId FK
    }
```

**MÃ´ táº£ quan há»‡:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      users       â”‚
â”‚   (User Service) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:1
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   portfolios     â”‚
â”‚(Portfolio Service)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     trades       â”‚     â”‚  notifications   â”‚
â”‚ (Trade Service)  â”‚     â”‚(Notif. Service)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ 1:N
                                  â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   pricealerts    â”‚
                         â”‚(Notif. Service)  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Quan há»‡ | MÃ´ táº£ |
|---------|-------|
| User â†’ Portfolio | 1:1 - Má»—i user cÃ³ Ä‘Ãºng 1 portfolio |
| User â†’ Trades | 1:N - Má»—i user cÃ³ nhiá»u giao dá»‹ch |
| User â†’ Notifications | 1:N - Má»—i user cÃ³ nhiá»u thÃ´ng bÃ¡o |
| User â†’ PriceAlerts | 1:N - Má»—i user cÃ³ nhiá»u cáº£nh bÃ¡o |

---

## 4.3. Báº£ng dá»¯ liá»‡u (Sample Data)

### Báº£ng users

| _id | email | fullName | role | balance | isActive |
|-----|-------|----------|------|---------|----------|
| 64a1b2c3d4e5f6a7b8c9d0e1 | user@example.com | Nguyá»…n VÄƒn A | user | 850.50 | true |
| 64a1b2c3d4e5f6a7b8c9d0e2 | admin@example.com | Admin | admin | 1000.00 | true |

### Báº£ng portfolios

| _id | userId | holdings | totalValue | totalInvested | totalProfit |
|-----|--------|----------|------------|---------------|-------------|
| 64a... | 64a1b2...d0e1 | [{symbol: "BTC", amount: 0.001, averageBuyPrice: 75000}] | 76.50 | 75.00 | 1.50 |

### Báº£ng trades

| _id | userId | type | symbol | amount | price | totalCost | executedAt |
|-----|--------|------|--------|--------|-------|-----------|------------|
| 64a... | 64a1b2...d0e1 | buy | BTC | 0.001 | 75000 | 75.075 | 2024-01-01 10:30:00 |
| 64a... | 64a1b2...d0e1 | sell | ETH | 0.5 | 4200 | 2100 | 2024-01-02 14:15:00 |

---

# 5. GIAO DIá»†N Cá»¦A Há»† THá»NG

## 5.1. Giao diá»‡n API cho tá»«ng dá»‹ch vá»¥

### 5.1.1. Chuáº©n API Response

**Success Response:**
```json
{
  "success": true,
  "data": { ... },
  "message": "Thao tÃ¡c thÃ nh cÃ´ng"
}
```

**Error Response:**
```json
{
  "success": false,
  "message": "MÃ´ táº£ lá»—i",
  "error": "Chi tiáº¿t lá»—i (náº¿u cÃ³)"
}
```

### 5.1.2. Authentication Header

```
Authorization: Bearer <JWT_TOKEN>
```

### 5.1.3. Danh sÃ¡ch API Endpoints

**BASE URL:** `http://localhost:3000/api`

| Service | Method | Endpoint | Auth | MÃ´ táº£ |
|---------|--------|----------|------|-------|
| **User** | POST | /users/register | âŒ | ÄÄƒng kÃ½ |
| | POST | /users/login | âŒ | ÄÄƒng nháº­p |
| | GET | /users/profile | âœ… | Láº¥y profile |
| | PUT | /users/profile | âœ… | Cáº­p nháº­t profile |
| | GET | /users/balance | âœ… | Láº¥y sá»‘ dÆ° |
| **Market** | GET | /market/prices | âœ… | GiÃ¡ táº¥t cáº£ coins |
| | GET | /market/price/:coinId | âœ… | GiÃ¡ má»™t coin |
| | GET | /market/chart/:coinId | âœ… | Dá»¯ liá»‡u chart |
| **Trade** | POST | /trade/buy | âœ… | Mua coin |
| | POST | /trade/sell | âœ… | BÃ¡n coin |
| | GET | /trade/history | âœ… | Lá»‹ch sá»­ giao dá»‹ch |
| **Portfolio** | GET | /portfolio | âœ… | Xem portfolio |
| **Notification** | GET | /notifications | âœ… | Danh sÃ¡ch thÃ´ng bÃ¡o |
| | PUT | /notifications/:id/read | âœ… | ÄÃ¡nh dáº¥u Ä‘Ã£ Ä‘á»c |
| | POST | /notifications/alert | âœ… | Táº¡o cáº£nh bÃ¡o giÃ¡ |
| **Admin** | GET | /users/admin/users | âœ… Admin | Danh sÃ¡ch users |
| | PUT | /users/admin/users/:id/toggle | âœ… Admin | KhÃ³a/Má»Ÿ user |

### 5.1.4. Chi tiáº¿t API Request/Response

**POST /users/login**

Request:
```json
{
  "email": "user@example.com",
  "password": "123456"
}
```

Response (200):
```json
{
  "success": true,
  "data": {
    "user": {
      "_id": "64a1b2c3d4e5f6a7b8c9d0e1",
      "email": "user@example.com",
      "fullName": "Nguyá»…n VÄƒn A",
      "balance": 1000,
      "role": "user"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

**POST /trade/buy**

Request:
```json
{
  "symbol": "BTC",
  "coinId": "bitcoin",
  "amount": 0.001
}
```

Response (200):
```json
{
  "success": true,
  "data": {
    "trade": {
      "_id": "64a...",
      "type": "buy",
      "symbol": "BTC",
      "amount": 0.001,
      "price": 75000,
      "totalCost": 75.075,
      "fee": 0.075,
      "status": "completed"
    },
    "newBalance": 924.925
  },
  "message": "Mua BTC thÃ nh cÃ´ng"
}
```

---

## 5.2. Giao diá»‡n ngÆ°á»i dÃ¹ng (Web)

**CÃ´ng nghá»‡ sá»­ dá»¥ng:**
- **Framework:** React 18 + Vite
- **Styling:** TailwindCSS
- **Charts:** Recharts
- **Icons:** Lucide React
- **HTTP Client:** Axios
- **Real-time:** Socket.IO Client

### 5.2.1. Danh sÃ¡ch mÃ n hÃ¬nh

| STT | Trang | Route | MÃ´ táº£ |
|-----|-------|-------|-------|
| 1 | ÄÄƒng nháº­p/ÄÄƒng kÃ½ | /auth | Form login/register |
| 2 | Dashboard | /dashboard | Tá»•ng quan, giÃ¡ coins |
| 3 | Giao dá»‹ch | /trade | Form mua/bÃ¡n coin |
| 4 | Chi tiáº¿t Coin | /coin/:id | ThÃ´ng tin vÃ  chart |
| 5 | Portfolio | /portfolio | Danh má»¥c Ä‘áº§u tÆ° |
| 6 | Lá»‹ch sá»­ | /history | Lá»‹ch sá»­ giao dá»‹ch |
| 7 | ThÃ´ng bÃ¡o | /notifications | Danh sÃ¡ch thÃ´ng bÃ¡o |
| 8 | CÃ i Ä‘áº·t | /settings | Profile, cáº£nh bÃ¡o giÃ¡ |
| 9 | Admin | /admin | Quáº£n lÃ½ users (Admin) |

### 5.2.2. Wireframe/Mockup

**[CHá»ªA TRá»NG - ChÃ¨n screenshot hoáº·c mockup cÃ¡c mÃ n hÃ¬nh]**

**MÃ n hÃ¬nh Dashboard:**
- Hiá»ƒn thá»‹ sá»‘ dÆ° hiá»‡n táº¡i
- Báº£ng giÃ¡ coins real-time
- TÃ³m táº¯t portfolio
- Chart xu hÆ°á»›ng giÃ¡

**MÃ n hÃ¬nh Trade:**
- Chá»n coin Ä‘á»ƒ giao dá»‹ch
- Tab Buy/Sell
- Nháº­p sá»‘ tiá»n USDT hoáº·c sá»‘ lÆ°á»£ng coin
- Preview tá»•ng chi phÃ­ vÃ  phÃ­

**MÃ n hÃ¬nh Portfolio:**
- Biá»ƒu Ä‘á»“ trÃ²n phÃ¢n bá»•
- Báº£ng holdings vá»›i P&L
- Tá»•ng lÃ£i/lá»—

---

# 6. Káº¾T LUáº¬N

## 6.1. Káº¿t quáº£ Ä‘áº¡t Ä‘Æ°á»£c

### Vá» máº·t kiáº¿n trÃºc:

1. **Ãp dá»¥ng thÃ nh cÃ´ng kiáº¿n trÃºc SOA:** Há»‡ thá»‘ng Ä‘Æ°á»£c chia thÃ nh 5 services Ä‘á»™c láº­p sá»­ dá»¥ng chung database, má»—i service cÃ³ trÃ¡ch nhiá»‡m rÃµ rÃ ng vÃ  cÃ³ thá»ƒ phÃ¡t triá»ƒn, triá»ƒn khai riÃªng biá»‡t.

2. **API Gateway Pattern:** Triá»ƒn khai má»™t Ä‘iá»ƒm vÃ o duy nháº¥t giÃºp Ä‘Æ¡n giáº£n hÃ³a viá»‡c giao tiáº¿p giá»¯a client vÃ  cÃ¡c services, Ä‘á»“ng thá»i táº­p trung xá»­ lÃ½ cross-cutting concerns (authentication, rate limiting).

3. **Orchestration Pattern:** Sá»­ dá»¥ng orchestrator táº¡i API Gateway Ä‘á»ƒ Ä‘iá»u phá»‘i cÃ¡c giao dá»‹ch phá»©c táº¡p cáº§n nhiá»u services, Ä‘áº£m báº£o tÃ­nh toÃ n váº¹n dá»¯ liá»‡u.

4. **Circuit Breaker Pattern:** TÃ­ch há»£p Opossum Ä‘á»ƒ ngÄƒn cháº·n cascading failures khi má»™t service gáº·p sá»± cá»‘.

5. **Service Discovery:** Sá»­ dá»¥ng Consul cho viá»‡c Ä‘Äƒng kÃ½ vÃ  khÃ¡m phÃ¡ services Ä‘á»™ng.

### Vá» máº·t chá»©c nÄƒng:

1. **HoÃ n thÃ nh 30 REST API endpoints** phá»¥c vá»¥ Ä‘áº§y Ä‘á»§ cÃ¡c chá»©c nÄƒng nghiá»‡p vá»¥.

2. **Real-time communication** vá»›i 4 WebSocket events cho giao dá»‹ch vÃ  thÃ´ng bÃ¡o.

3. **Giao diá»‡n ngÆ°á»i dÃ¹ng** trá»±c quan vá»›i 9 trang chá»©c nÄƒng.

4. **Há»‡ thá»‘ng Admin** cho phÃ©p quáº£n lÃ½ ngÆ°á»i dÃ¹ng.

## 6.2. Æ¯u Ä‘iá»ƒm cá»§a kiáº¿n trÃºc SOA Ã¡p dá»¥ng

| Æ¯u Ä‘iá»ƒm | MÃ´ táº£ |
|---------|-------|
| **Loose Coupling** | CÃ¡c services Ä‘á»™c láº­p, thay Ä‘á»•i má»™t service khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n service khÃ¡c |
| **Scalability** | CÃ³ thá»ƒ scale tá»«ng service riÃªng biá»‡t theo nhu cáº§u |
| **Fault Isolation** | Lá»—i á»Ÿ má»™t service khÃ´ng lÃ m sáº­p toÃ n há»‡ thá»‘ng |
| **Technology Diversity** | Má»—i service cÃ³ thá»ƒ sá»­ dá»¥ng cÃ´ng nghá»‡ phÃ¹ há»£p |
| **Team Independence** | CÃ¡c team cÃ³ thá»ƒ phÃ¡t triá»ƒn song song |
| **Reusability** | Services cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng cho cÃ¡c á»©ng dá»¥ng khÃ¡c |

## 6.3. Háº¡n cháº¿ vÃ  hÆ°á»›ng phÃ¡t triá»ƒn

### Háº¡n cháº¿:

1. **Complexity:** Kiáº¿n trÃºc SOA phá»©c táº¡p hÆ¡n monolithic, Ä‘Ã²i há»i kiáº¿n thá»©c vá» distributed systems.

2. **Network Latency:** Giao tiáº¿p giá»¯a cÃ¡c services qua HTTP cÃ³ Ä‘á»™ trá»… cao hÆ¡n in-process calls.

3. **Data Consistency:** Vá»›i cÃ¡c services sá»­ dá»¥ng chung database, cáº§n Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n dá»¯ liá»‡u khi cÃ³ nhiá»u transactions.

4. **Monitoring:** Cáº§n cÃ´ng cá»¥ logging vÃ  monitoring táº­p trung Ä‘á»ƒ theo dÃµi há»‡ thá»‘ng.

### HÆ°á»›ng phÃ¡t triá»ƒn:

1. **Event-Driven Architecture:** Sá»­ dá»¥ng message queue (RabbitMQ, Kafka) thay vÃ¬ HTTP calls Ä‘á»ƒ tÄƒng tÃ­nh resilience.

2. **Kubernetes Deployment:** Containerize services vá»›i Docker vÃ  orchestrate báº±ng Kubernetes.

3. **Centralized Logging:** TÃ­ch há»£p ELK Stack (Elasticsearch, Logstash, Kibana) cho logging.

4. **API Documentation:** Sá»­ dá»¥ng Swagger/OpenAPI cho documentation tá»± Ä‘á»™ng.

5. **Testing:** Bá»• sung unit tests, integration tests vÃ  contract tests.

6. **Security:** Implement OAuth 2.0, HTTPS, vÃ  API key management.

## 6.4. BÃ i há»c kinh nghiá»‡m

1. **Design API trÆ°á»›c:** Thiáº¿t káº¿ API contract trÆ°á»›c khi implement giÃºp cÃ¡c services phÃ¡t triá»ƒn song song.

2. **Circuit Breaker lÃ  báº¯t buá»™c:** Trong distributed system, pháº£i cÃ³ cÆ¡ cháº¿ xá»­ lÃ½ khi service downstream fail.

3. **Logging lÃ  quan trá»ng:** KhÃ´ng cÃ³ logs táº­p trung, debug cÃ¡c services ráº¥t khÃ³ khÄƒn.

4. **Rollback mechanism:** Vá»›i cÃ¡c transaction liÃªn quan nhiá»u services, cáº§n cÃ³ chiáº¿n lÆ°á»£c rollback rÃµ rÃ ng.

5. **Cache giÃºp giáº£m táº£i:** Caching á»Ÿ Market Service giÃºp giáº£m Ä‘Ã¡ng ká»ƒ API calls Ä‘áº¿n CoinGecko.

---

# PHá»¤ Lá»¤C

## A. CÃ´ng nghá»‡ sá»­ dá»¥ng

| Layer | CÃ´ng nghá»‡ |
|-------|-----------|
| **Frontend** | React 18, Vite, TailwindCSS, Recharts, Axios, Socket.IO Client |
| **API Gateway** | Express.js, http-proxy-middleware, Socket.IO |
| **Backend Services** | Node.js, Express.js, Mongoose |
| **Database** | MongoDB |
| **Authentication** | JWT, bcryptjs |
| **External APIs** | CoinGecko, CoinPaprika |
| **Patterns** | Circuit Breaker (Opossum), Service Discovery (Consul) |

## B. Cáº¥u trÃºc thÆ° má»¥c

```
CryptoTradingSOA/
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ pages/          # 9 trang
â”‚       â”œâ”€â”€ components/     # UI components
â”‚       â”œâ”€â”€ services/       # API, WebSocket
â”‚       â””â”€â”€ context/        # Auth context
â”‚
â””â”€â”€ backend/
    â”œâ”€â”€ api-gateway/
    â”‚   â”œâ”€â”€ server.js
    â”‚   â””â”€â”€ orchestration/
    â”œâ”€â”€ services/
    â”‚   â”œâ”€â”€ user-service/
    â”‚   â”œâ”€â”€ market-service/
    â”‚   â”œâ”€â”€ portfolio-service/
    â”‚   â”œâ”€â”€ trade-service/
    â”‚   â””â”€â”€ notification-service/
    â””â”€â”€ shared/
        â”œâ”€â”€ config/
        â”œâ”€â”€ middleware/
        â””â”€â”€ utils/
```

## C. HÆ°á»›ng dáº«n cÃ i Ä‘áº·t vÃ  cháº¡y

```bash
# 1. Clone repository
git clone <repo-url>

# 2. CÃ i Ä‘áº·t dependencies
cd backend && npm install
cd ../frontend && npm install

# 3. Táº¡o file .env (copy tá»« .env.example)

# 4. Cháº¡y MongoDB vÃ  Consul

# 5. Cháº¡y backend
cd backend
.\start-all-services.ps1

# 6. Cháº¡y frontend
cd frontend
npm run dev
```

---

**[Háº¾T BÃO CÃO]**
