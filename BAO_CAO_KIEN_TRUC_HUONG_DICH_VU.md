# B√ÅO C√ÅO M√îN H·ªåC
# KI·∫æN TR√öC H∆Ø·ªöNG D·ªäCH V·ª§ (SOA)

## ƒê·ªÄ T√ÄI: H·ªÜ TH·ªêNG GIAO D·ªäCH TI·ªÄN ƒêI·ªÜN T·ª¨ (CryptoTrading)

---

**Sinh vi√™n th·ª±c hi·ªán:** [H·ªç t√™n sinh vi√™n]  
**MSSV:** [M√£ s·ªë sinh vi√™n]  
**L·ªõp:** [T√™n l·ªõp]  
**Gi·∫£ng vi√™n h∆∞·ªõng d·∫´n:** [T√™n gi·∫£ng vi√™n]

---

# M·ª§C L·ª§C

1. [B√†i to√°n](#1-b√†i-to√°n)
2. [Ph√¢n t√≠ch ch·ª©c nƒÉng c·ªßa h·ªá th·ªëng](#2-ph√¢n-t√≠ch-ch·ª©c-nƒÉng-c·ªßa-h·ªá-th·ªëng)
3. [Ph√¢n r√£ ch·ª©c nƒÉng con (d·ªãch v·ª•)](#3-ph√¢n-r√£-ch·ª©c-nƒÉng-con-d·ªãch-v·ª•)
4. [Ph√¢n t√≠ch v√† thi·∫øt k·∫ø d·ªØ li·ªáu](#4-ph√¢n-t√≠ch-v√†-thi·∫øt-k·∫ø-d·ªØ-li·ªáu)
5. [Giao di·ªán c·ªßa h·ªá th·ªëng](#5-giao-di·ªán-c·ªßa-h·ªá-th·ªëng)
6. [K·∫øt lu·∫≠n](#6-k·∫øt-lu·∫≠n)

---

# 1. B√ÄI TO√ÅN

## 1.1. Ph√°t bi·ªÉu b√†i to√°n

Trong b·ªëi c·∫£nh th·ªã tr∆∞·ªùng ti·ªÅn ƒëi·ªán t·ª≠ (cryptocurrency) ng√†y c√†ng ph√°t tri·ªÉn m·∫°nh m·∫Ω tr√™n to√†n c·∫ßu, nhu c·∫ßu v·ªÅ c√°c n·ªÅn t·∫£ng giao d·ªãch ti·ªÅn ƒëi·ªán t·ª≠ an to√†n, nhanh ch√≥ng v√† d·ªÖ s·ª≠ d·ª•ng ng√†y c√†ng tƒÉng cao. Tuy nhi√™n, c√°c n·ªÅn t·∫£ng giao d·ªãch hi·ªán t·∫°i g·∫∑p ph·∫£i m·ªôt s·ªë v·∫•n ƒë·ªÅ:

**C√°c v·∫•n ƒë·ªÅ hi·ªán t·∫°i:**

1. **H·ªá th·ªëng monolithic kh√≥ m·ªü r·ªông:** C√°c h·ªá th·ªëng giao d·ªãch truy·ªÅn th·ªëng th∆∞·ªùng ƒë∆∞·ª£c x√¢y d·ª±ng theo ki·∫øn tr√∫c monolithic, khi·∫øn vi·ªác m·ªü r·ªông quy m√¥ khi l∆∞·ª£ng ng∆∞·ªùi d√πng tƒÉng cao tr·ªü n√™n kh√≥ khƒÉn v√† t·ªën k√©m.

2. **Kh√≥ khƒÉn trong b·∫£o tr√¨ v√† c·∫≠p nh·∫≠t:** Khi to√†n b·ªô logic nghi·ªáp v·ª• n·∫±m trong m·ªôt ·ª©ng d·ª•ng duy nh·∫•t, vi·ªác s·ª≠a l·ªói ho·∫∑c th√™m t√≠nh nƒÉng m·ªõi c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn to√†n b·ªô h·ªá th·ªëng.

3. **Single point of failure:** N·∫øu m·ªôt ph·∫ßn c·ªßa h·ªá th·ªëng g·∫∑p s·ª± c·ªë, to√†n b·ªô ·ª©ng d·ª•ng c√≥ th·ªÉ ng·ª´ng ho·∫°t ƒë·ªông.

4. **Kh√≥ t√≠ch h·ª£p v·ªõi c√°c d·ªãch v·ª• b√™n th·ª© ba:** Vi·ªác k·∫øt n·ªëi v·ªõi c√°c API cung c·∫•p gi√° coin, d·ªãch v·ª• thanh to√°n, ho·∫∑c h·ªá th·ªëng th√¥ng b√°o tr·ªü n√™n ph·ª©c t·∫°p.

**Gi·∫£i ph√°p ƒë·ªÅ xu·∫•t:**

X√¢y d·ª±ng m·ªôt h·ªá th·ªëng giao d·ªãch ti·ªÅn ƒëi·ªán t·ª≠ m√¥ ph·ªèng (paper trading) theo **ki·∫øn tr√∫c h∆∞·ªõng d·ªãch v·ª• (SOA - Service-Oriented Architecture)**, trong ƒë√≥:

- H·ªá th·ªëng ƒë∆∞·ª£c chia th√†nh c√°c d·ªãch v·ª• ƒë·ªôc l·∫≠p (services), m·ªói d·ªãch v·ª• ƒë·∫£m nhi·ªám m·ªôt ch·ª©c nƒÉng nghi·ªáp v·ª• c·ª• th·ªÉ.
- C√°c d·ªãch v·ª• giao ti·∫øp v·ªõi nhau th√¥ng qua API Gateway.
- H·ªá th·ªëng c√≥ kh·∫£ nƒÉng m·ªü r·ªông linh ho·∫°t, d·ªÖ b·∫£o tr√¨ v√† c√≥ t√≠nh s·∫µn s√†ng cao.

**Ph·∫°m vi b√†i to√°n:**

- H·ªá th·ªëng cho ph√©p ng∆∞·ªùi d√πng ƒëƒÉng k√Ω, ƒëƒÉng nh·∫≠p v√† qu·∫£n l√Ω t√†i kho·∫£n.
- Ng∆∞·ªùi d√πng ƒë∆∞·ª£c c·∫•p s·ªë d∆∞ ·∫£o (1000 USDT) ƒë·ªÉ th·ª±c hi·ªán giao d·ªãch mua/b√°n coin.
- H·ªá th·ªëng hi·ªÉn th·ªã gi√° coin real-time t·ª´ API b√™n ngo√†i (CoinGecko).
- Ng∆∞·ªùi d√πng c√≥ th·ªÉ xem danh m·ª•c ƒë·∫ßu t∆∞, l·ªãch s·ª≠ giao d·ªãch v√† l√£i/l·ªó.
- H·ªá th·ªëng h·ªó tr·ª£ th√¥ng b√°o v√† c·∫£nh b√°o gi√°.
- C√≥ ch·ª©c nƒÉng qu·∫£n tr·ªã vi√™n (Admin) ƒë·ªÉ qu·∫£n l√Ω ng∆∞·ªùi d√πng.

---

# 2. PH√ÇN T√çCH CH·ª®C NƒÇNG C·ª¶A H·ªÜ TH·ªêNG

## 2.1. X√°c ƒë·ªãnh m·ª•c ti√™u c·ªßa h·ªá th·ªëng

### M·ª•c ti√™u t·ªïng qu√°t:

X√¢y d·ª±ng m·ªôt n·ªÅn t·∫£ng giao d·ªãch ti·ªÅn ƒëi·ªán t·ª≠ m√¥ ph·ªèng theo ki·∫øn tr√∫c h∆∞·ªõng d·ªãch v·ª•, cho ph√©p ng∆∞·ªùi d√πng tr·∫£i nghi·ªám vi·ªác mua b√°n coin m√† kh√¥ng c·∫ßn s·ª≠ d·ª•ng ti·ªÅn th·∫≠t.

### M·ª•c ti√™u c·ª• th·ªÉ:

| STT | M·ª•c ti√™u | M√¥ t·∫£ |
|-----|----------|-------|
| 1 | **Qu·∫£n l√Ω ng∆∞·ªùi d√πng** | Cho ph√©p ƒëƒÉng k√Ω, ƒëƒÉng nh·∫≠p, qu·∫£n l√Ω profile v√† s·ªë d∆∞ ·∫£o |
| 2 | **Cung c·∫•p d·ªØ li·ªáu th·ªã tr∆∞·ªùng** | Hi·ªÉn th·ªã gi√° coin real-time, bi·ªÉu ƒë·ªì l·ªãch s·ª≠ gi√° |
| 3 | **Th·ª±c hi·ªán giao d·ªãch** | Cho ph√©p mua/b√°n coin v·ªõi gi√° th·ª±c t·∫ø t·ª´ th·ªã tr∆∞·ªùng |
| 4 | **Qu·∫£n l√Ω danh m·ª•c ƒë·∫ßu t∆∞** | Theo d√µi holdings, t√≠nh to√°n l√£i/l·ªó theo th·ªùi gian th·ª±c |
| 5 | **Ghi nh·∫≠n l·ªãch s·ª≠** | L∆∞u tr·ªØ v√† hi·ªÉn th·ªã l·ªãch s·ª≠ t·∫•t c·∫£ giao d·ªãch |
| 6 | **Th√¥ng b√°o ng∆∞·ªùi d√πng** | G·ª≠i th√¥ng b√°o giao d·ªãch, c·∫£nh b√°o gi√° |
| 7 | **Qu·∫£n tr·ªã h·ªá th·ªëng** | Cho ph√©p admin qu·∫£n l√Ω users, xem th·ªëng k√™ |

## 2.2. Y√™u c·∫ßu ch·ª©c nƒÉng v√† phi ch·ª©c nƒÉng

### 2.2.1. Y√™u c·∫ßu ch·ª©c nƒÉng (Functional Requirements)

**A. Ch·ª©c nƒÉng x√°c th·ª±c v√† ng∆∞·ªùi d√πng:**

| ID | Ch·ª©c nƒÉng | M√¥ t·∫£ chi ti·∫øt |
|----|-----------|----------------|
| FR01 | ƒêƒÉng k√Ω t√†i kho·∫£n | Ng∆∞·ªùi d√πng c√≥ th·ªÉ t·∫°o t√†i kho·∫£n v·ªõi email, m·∫≠t kh·∫©u v√† h·ªç t√™n |
| FR02 | ƒêƒÉng nh·∫≠p | X√°c th·ª±c b·∫±ng email v√† m·∫≠t kh·∫©u, nh·∫≠n JWT token |
| FR03 | Xem profile | Hi·ªÉn th·ªã th√¥ng tin c√° nh√¢n v√† s·ªë d∆∞ hi·ªán t·∫°i |
| FR04 | C·∫≠p nh·∫≠t profile | Cho ph√©p thay ƒë·ªïi h·ªç t√™n |
| FR05 | Xem l·ªãch s·ª≠ s·ªë d∆∞ | Hi·ªÉn th·ªã bi·∫øn ƒë·ªông s·ªë d∆∞ theo th·ªùi gian |

**B. Ch·ª©c nƒÉng th·ªã tr∆∞·ªùng:**

| ID | Ch·ª©c nƒÉng | M√¥ t·∫£ chi ti·∫øt |
|----|-----------|----------------|
| FR06 | Xem gi√° t·∫•t c·∫£ coins | Hi·ªÉn th·ªã danh s√°ch coin v·ªõi gi√° hi·ªán t·∫°i v√† bi·∫øn ƒë·ªông 24h |
| FR07 | Xem chi ti·∫øt coin | Hi·ªÉn th·ªã th√¥ng tin chi ti·∫øt v√† bi·ªÉu ƒë·ªì gi√° c·ªßa m·ªôt coin |
| FR08 | Xem bi·ªÉu ƒë·ªì l·ªãch s·ª≠ | Hi·ªÉn th·ªã chart gi√° 7 ng√†y g·∫ßn nh·∫•t |

**C. Ch·ª©c nƒÉng giao d·ªãch:**

| ID | Ch·ª©c nƒÉng | M√¥ t·∫£ chi ti·∫øt |
|----|-----------|----------------|
| FR09 | Mua coin | Mua coin v·ªõi s·ªë l∆∞·ª£ng ch·ªâ ƒë·ªãnh, tr·ª´ s·ªë d∆∞, c·ªông holdings |
| FR10 | B√°n coin | B√°n coin ƒëang s·ªü h·ªØu, c·ªông s·ªë d∆∞, gi·∫£m holdings |
| FR11 | Xem l·ªãch s·ª≠ giao d·ªãch | Hi·ªÉn th·ªã danh s√°ch giao d·ªãch v·ªõi b·ªô l·ªçc v√† ph√¢n trang |

**D. Ch·ª©c nƒÉng danh m·ª•c ƒë·∫ßu t∆∞:**

| ID | Ch·ª©c nƒÉng | M√¥ t·∫£ chi ti·∫øt |
|----|-----------|----------------|
| FR12 | Xem portfolio | Hi·ªÉn th·ªã holdings v·ªõi gi√° hi·ªán t·∫°i v√† P&L |
| FR13 | T√≠nh to√°n l√£i/l·ªó | T·ª± ƒë·ªông t√≠nh profit d·ª±a tr√™n gi√° mua trung b√¨nh v√† gi√° hi·ªán t·∫°i |

**E. Ch·ª©c nƒÉng th√¥ng b√°o:**

| ID | Ch·ª©c nƒÉng | M√¥ t·∫£ chi ti·∫øt |
|----|-----------|----------------|
| FR14 | Xem th√¥ng b√°o | Hi·ªÉn th·ªã danh s√°ch th√¥ng b√°o |
| FR15 | ƒê√°nh d·∫•u ƒë√£ ƒë·ªçc | ƒê√°nh d·∫•u m·ªôt ho·∫∑c t·∫•t c·∫£ th√¥ng b√°o ƒë√£ ƒë·ªçc |
| FR16 | X√≥a th√¥ng b√°o | X√≥a th√¥ng b√°o kh√¥ng c·∫ßn thi·∫øt |
| FR17 | T·∫°o c·∫£nh b√°o gi√° | ƒê·∫∑t alert khi coin ƒë·∫°t gi√° m·ª•c ti√™u |
| FR18 | Qu·∫£n l√Ω c·∫£nh b√°o | Xem v√† x√≥a c√°c c·∫£nh b√°o gi√° ƒë√£ t·∫°o |

**F. Ch·ª©c nƒÉng qu·∫£n tr·ªã:**

| ID | Ch·ª©c nƒÉng | M√¥ t·∫£ chi ti·∫øt |
|----|-----------|----------------|
| FR19 | Xem danh s√°ch user | Admin xem t·∫•t c·∫£ ng∆∞·ªùi d√πng |
| FR20 | Kh√≥a/M·ªü kh√≥a user | Toggle tr·∫°ng th√°i active c·ªßa user |
| FR21 | C·∫≠p nh·∫≠t s·ªë d∆∞ user | ƒêi·ªÅu ch·ªânh s·ªë d∆∞ (+ ho·∫∑c -) c·ªßa user |
| FR22 | X√≥a user | X√≥a t√†i kho·∫£n ng∆∞·ªùi d√πng |
| FR23 | Xem th·ªëng k√™ h·ªá th·ªëng | Xem t·ªïng user, t·ªïng s·ªë d∆∞, v.v. |

### 2.2.2. Y√™u c·∫ßu phi ch·ª©c nƒÉng (Non-Functional Requirements)

| ID | Lo·∫°i | Y√™u c·∫ßu | M√¥ t·∫£ |
|----|------|---------|-------|
| NFR01 | **Hi·ªáu nƒÉng** | Response time < 2s | Th·ªùi gian ph·∫£n h·ªìi API d∆∞·ªõi 2 gi√¢y |
| NFR02 | **Hi·ªáu nƒÉng** | Concurrent users | H·ªó tr·ª£ t·ªëi thi·ªÉu 100 ng∆∞·ªùi d√πng ƒë·ªìng th·ªùi |
| NFR03 | **B·∫£o m·∫≠t** | JWT Authentication | X√°c th·ª±c ng∆∞·ªùi d√πng b·∫±ng JSON Web Token |
| NFR04 | **B·∫£o m·∫≠t** | Password hashing | M√£ h√≥a m·∫≠t kh·∫©u b·∫±ng bcrypt |
| NFR05 | **B·∫£o m·∫≠t** | Rate limiting | Gi·ªõi h·∫°n request ƒë·ªÉ ch·ªëng DDoS |
| NFR06 | **Kh·∫£ d·ª•ng** | 99% uptime | H·ªá th·ªëng ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh |
| NFR07 | **Kh·∫£ d·ª•ng** | Circuit Breaker | T·ª± ƒë·ªông ng·∫Øt k·∫øt n·ªëi khi service l·ªói |
| NFR08 | **M·ªü r·ªông** | Horizontal scaling | C√≥ th·ªÉ m·ªü r·ªông t·ª´ng service ƒë·ªôc l·∫≠p |
| NFR09 | **B·∫£o tr√¨** | Loose coupling | C√°c service √≠t ph·ª• thu·ªôc l·∫´n nhau |
| NFR10 | **Real-time** | WebSocket | C·∫≠p nh·∫≠t d·ªØ li·ªáu real-time |

## 2.3. Bi·ªÉu ƒë·ªì ch·ª©c nƒÉng

**Bi·ªÉu ƒë·ªì Use Case t·ªïng quan h·ªá th·ªëng:**

```mermaid
flowchart LR
    User((üë§ User))
    Admin((üëë Admin))

    User --> A[X√°c th·ª±c<br/>ƒêƒÉng k√Ω/ƒêƒÉng nh·∫≠p]
    User --> B[Th·ªã tr∆∞·ªùng<br/>Gi√° coin, Bi·ªÉu ƒë·ªì]
    User --> C[Giao d·ªãch<br/>Mua/B√°n coin]
    User --> D[Portfolio<br/>Danh m·ª•c ƒë·∫ßu t∆∞]
    User --> E[Th√¥ng b√°o<br/>C·∫£nh b√°o gi√°]

    Admin -.->|extends| User
    Admin --> F[Qu·∫£n tr·ªã Users<br/>Xem, Kh√≥a, X√≥a]
    Admin --> G[Qu·∫£n tr·ªã Balance<br/>ƒêi·ªÅu ch·ªânh s·ªë d∆∞]
    Admin --> H[Th·ªëng k√™<br/>Xem stats h·ªá th·ªëng]
```

**Ch√∫ th√≠ch:**
- **User**: Ng∆∞·ªùi d√πng th√¥ng th∆∞·ªùng
- **Admin**: K·∫ø th·ª´a t·∫•t c·∫£ quy·ªÅn c·ªßa User (m≈©i t√™n ƒë·ª©t `extends`) + c√≥ th√™m c√°c ch·ª©c nƒÉng qu·∫£n tr·ªã
- Admin c√≥ th·ªÉ: trade, xem portfolio, th√¥ng b√°o... nh∆∞ User + qu·∫£n l√Ω users, ƒëi·ªÅu ch·ªânh balance

**Chi ti·∫øt c√°c nh√≥m Use Case:**

| Nh√≥m | Use Cases | Service | Actor |
|------|-----------|---------|-------|
| **X√°c th·ª±c** | ƒêƒÉng k√Ω, ƒêƒÉng nh·∫≠p, Profile, S·ªë d∆∞ | User Service | User, Admin |
| **Th·ªã tr∆∞·ªùng** | Gi√° coins, Chi ti·∫øt coin, Bi·ªÉu ƒë·ªì | Market Service | User, Admin |
| **Giao d·ªãch** | Mua coin, B√°n coin, L·ªãch s·ª≠ | Trade Orchestration | User, Admin |
| **Portfolio** | Xem holdings, T√≠nh P&L | Portfolio Service | User, Admin |
| **Th√¥ng b√°o** | Xem/X√≥a th√¥ng b√°o, C·∫£nh b√°o gi√° | Notification Service | User, Admin |
| **Qu·∫£n tr·ªã Users** | Xem danh s√°ch, Kh√≥a/M·ªü kh√≥a, X√≥a | User Service | **Admin only** |
| **Qu·∫£n tr·ªã Balance** | ƒêi·ªÅu ch·ªânh s·ªë d∆∞ user | User Service | **Admin only** |
| **Th·ªëng k√™** | Xem th·ªëng k√™ h·ªá th·ªëng | User Service | **Admin only** |

---

# 3. PH√ÇN R√É CH·ª®C NƒÇNG CON (D·ªäCH V·ª§)

## 3.1. Nguy√™n t·∫Øc ph√¢n r√£

H·ªá th·ªëng ƒë∆∞·ª£c ph√¢n r√£ theo nguy√™n t·∫Øc **Single Responsibility Principle (SRP)** - m·ªói d·ªãch v·ª• ch·ªâ ƒë·∫£m nhi·ªám m·ªôt tr√°ch nhi·ªám nghi·ªáp v·ª• duy nh·∫•t.

**C√°c d·ªãch v·ª• ƒë∆∞·ª£c ph√¢n r√£:**

| STT | D·ªãch v·ª• | Port | Tr√°ch nhi·ªám ch√≠nh |
|-----|---------|------|-------------------|
| 0 | **API Gateway** | 3000 | ƒê·ªãnh tuy·∫øn, x√°c th·ª±c, orchestration |
| 1 | **User Service** | 3001 | X√°c th·ª±c, qu·∫£n l√Ω ng∆∞·ªùi d√πng, s·ªë d∆∞ |
| 2 | **Market Service** | 3002 | D·ªØ li·ªáu gi√° coin t·ª´ API b√™n ngo√†i |
| 3 | **Portfolio Service** | 3003 | Qu·∫£n l√Ω danh m·ª•c ƒë·∫ßu t∆∞ |
| 4 | **Trade Service** | 3004 | Ghi nh·∫≠n l·ªãch s·ª≠ giao d·ªãch |
| 5 | **Notification Service** | 3005 | Th√¥ng b√°o v√† c·∫£nh b√°o gi√° |

**S∆° ƒë·ªì ki·∫øn tr√∫c h·ªá th·ªëng SOA:**

```mermaid
flowchart TB
    subgraph Client["üñ•Ô∏è Client Layer"]
        FE[React Frontend<br/>Port 5173]
    end

    subgraph Gateway["üö™ API Gateway Layer"]
        GW[API Gateway<br/>Port 3000<br/>Routing, Auth, Rate Limiting]
    end

    subgraph Services["‚öôÔ∏è Service Layer"]
        US[User Service<br/>Port 3001]
        MS[Market Service<br/>Port 3002]
        PS[Portfolio Service<br/>Port 3003]
        TS[Trade Service<br/>Port 3004]
        NS[Notification Service<br/>Port 3005]
    end

    subgraph External["üåê External APIs"]
        CG[CoinGecko API<br/>Primary]
        CP[CoinPaprika API<br/>Fallback]
    end

    subgraph Data["üíæ Shared Database"]
        DB[(MongoDB<br/>Shared Database)]
    end

    subgraph Discovery["üîç Service Discovery"]
        CS[Consul]
    end

    FE <-->|HTTP/WebSocket| GW
    GW <--> US
    GW <--> MS
    GW <--> PS
    GW <--> TS
    GW <--> NS
    
    MS <-->|API Call| CG
    MS -.->|Fallback| CP
    
    US --> DB
    PS --> DB
    TS --> DB
    NS --> DB

    US -.->|Register| CS
    MS -.->|Register| CS
    PS -.->|Register| CS
    TS -.->|Register| CS
    NS -.->|Register| CS
    GW -.->|Discover| CS
```

**ƒê·∫∑c ƒëi·ªÉm ki·∫øn tr√∫c SOA:**

| ƒê·∫∑c ƒëi·ªÉm | M√¥ t·∫£ |
|----------|-------|
| **Shared Database** | T·∫•t c·∫£ services k·∫øt n·ªëi c√πng m·ªôt MongoDB instance |
| **Service Discovery** | Consul qu·∫£n l√Ω ƒëƒÉng k√Ω v√† kh√°m ph√° services |
| **API Gateway** | Single entry point, x·ª≠ l√Ω routing v√† authentication |
| **Loose Coupling** | Services giao ti·∫øp qua HTTP REST APIs |
| **Orchestration** | API Gateway ƒëi·ªÅu ph·ªëi giao d·ªãch Buy/Sell |

## 3.2. M√¥ t·∫£ chi ti·∫øt t·ª´ng d·ªãch v·ª•

### 3.2.1. API Gateway

**M·ª•c ƒë√≠ch:** L√† ƒëi·ªÉm v√†o duy nh·∫•t (single entry point) cho t·∫•t c·∫£ c√°c request t·ª´ client.

**Ch·ª©c nƒÉng ch√≠nh:**

| Ch·ª©c nƒÉng | M√¥ t·∫£ |
|-----------|-------|
| **Routing** | ƒê·ªãnh tuy·∫øn request ƒë·∫øn ƒë√∫ng service |
| **Authentication** | X√°c th·ª±c JWT token |
| **Rate Limiting** | Gi·ªõi h·∫°n s·ªë request (1000/15 ph√∫t) |
| **Orchestration** | ƒêi·ªÅu ph·ªëi c√°c service cho giao d·ªãch buy/sell v√† portfolio |
| **WebSocket** | Qu·∫£n l√Ω k·∫øt n·ªëi real-time |

**C√¥ng ngh·ªá:** Express.js, http-proxy-middleware, Socket.IO

---

### 3.2.2. User Service

**M·ª•c ƒë√≠ch:** Qu·∫£n l√Ω to√†n b·ªô th√¥ng tin ng∆∞·ªùi d√πng v√† x√°c th·ª±c.

**Endpoints:**

| Method | Endpoint | M√¥ t·∫£ |
|--------|----------|-------|
| POST | /register | ƒêƒÉng k√Ω t√†i kho·∫£n m·ªõi |
| POST | /login | ƒêƒÉng nh·∫≠p, nh·∫≠n JWT token |
| GET | /profile | L·∫•y th√¥ng tin profile |
| PUT | /profile | C·∫≠p nh·∫≠t profile |
| GET | /balance | L·∫•y s·ªë d∆∞ hi·ªán t·∫°i |
| PUT | /balance | C·∫≠p nh·∫≠t s·ªë d∆∞ (internal) |
| GET | /admin/users | [Admin] Danh s√°ch users |
| GET | /admin/stats | [Admin] Th·ªëng k√™ h·ªá th·ªëng |
| PUT | /admin/users/:id/toggle | [Admin] Kh√≥a/M·ªü kh√≥a user |
| PUT | /admin/users/:id/balance | [Admin] C·∫≠p nh·∫≠t s·ªë d∆∞ |
| DELETE | /admin/users/:id | [Admin] X√≥a user |

**Database:** MongoDB - Collection `users`

**C√¥ng ngh·ªá:** Express.js, bcryptjs, jsonwebtoken, Mongoose

---

### 3.2.3. Market Service

**M·ª•c ƒë√≠ch:** Cung c·∫•p d·ªØ li·ªáu gi√° coin real-time t·ª´ API b√™n ngo√†i.

**Endpoints:**

| Method | Endpoint | M√¥ t·∫£ |
|--------|----------|-------|
| GET | /prices | Gi√° t·∫•t c·∫£ coins h·ªó tr·ª£ |
| GET | /price/:coinId | Gi√° chi ti·∫øt m·ªôt coin |
| GET | /chart/:coinId | D·ªØ li·ªáu bi·ªÉu ƒë·ªì 7 ng√†y |

**Ngu·ªìn d·ªØ li·ªáu:** CoinGecko API (Primary), CoinPaprika API (Fallback)

**Caching:** NodeCache v·ªõi TTL 2 ph√∫t ƒë·ªÉ gi·∫£m API calls

**C√¥ng ngh·ªá:** Express.js, axios, node-cache

---

### 3.2.4. Portfolio Service

**M·ª•c ƒë√≠ch:** Qu·∫£n l√Ω danh m·ª•c ƒë·∫ßu t∆∞ c·ªßa ng∆∞·ªùi d√πng.

**Endpoints:**

| Method | Endpoint | M√¥ t·∫£ |
|--------|----------|-------|
| GET | / | L·∫•y portfolio c·ªßa user |
| POST | /holding | Th√™m coin v√†o portfolio (internal) |
| PUT | /holding | Gi·∫£m/X√≥a coin kh·ªèi portfolio (internal) |

**Logic nghi·ªáp v·ª•:**

- **DCA (Dollar Cost Averaging):** Khi mua th√™m coin ƒë√£ c√≥, t√≠nh l·∫°i gi√° mua trung b√¨nh
  ```
  averageBuyPrice = totalInvested / totalAmount
  ```

- **Profit Calculation:**
  ```
  profit = currentValue - totalInvested
  profitPercentage = (profit / totalInvested) √ó 100
  ```

**Database:** MongoDB - Collection `portfolios`

**C√¥ng ngh·ªá:** Express.js, Mongoose

---

### 3.2.5. Trade Service

**M·ª•c ƒë√≠ch:** Ghi nh·∫≠n l·ªãch s·ª≠ t·∫•t c·∫£ giao d·ªãch.

**Endpoints:**

| Method | Endpoint | M√¥ t·∫£ |
|--------|----------|-------|
| POST | / | T·∫°o record giao d·ªãch m·ªõi |
| GET | /history | L·ªãch s·ª≠ giao d·ªãch v·ªõi filter |

**L∆∞u √Ω:** Trade Service KH√îNG th·ª±c hi·ªán logic mua/b√°n. Logic ƒë√≥ ƒë∆∞·ª£c x·ª≠ l√Ω b·ªüi **Trade Orchestration** ·ªü API Gateway.

**Database:** MongoDB - Collection `trades`

**C√¥ng ngh·ªá:** Express.js, Mongoose

---

### 3.2.6. Notification Service

**M·ª•c ƒë√≠ch:** Qu·∫£n l√Ω th√¥ng b√°o v√† c·∫£nh b√°o gi√°.

**Endpoints:**

| Method | Endpoint | M√¥ t·∫£ |
|--------|----------|-------|
| GET | / | Danh s√°ch th√¥ng b√°o |
| GET | /unread-count | S·ªë th√¥ng b√°o ch∆∞a ƒë·ªçc |
| POST | /send | G·ª≠i th√¥ng b√°o (internal) |
| PUT | /:id/read | ƒê√°nh d·∫•u ƒë√£ ƒë·ªçc |
| PUT | /read-all | ƒê√°nh d·∫•u t·∫•t c·∫£ ƒë√£ ƒë·ªçc |
| DELETE | /:id | X√≥a th√¥ng b√°o |
| POST | /alert | T·∫°o c·∫£nh b√°o gi√° |
| GET | /alerts | Danh s√°ch c·∫£nh b√°o |
| DELETE | /alert/:id | X√≥a c·∫£nh b√°o |

**Cron Job:** Ki·ªÉm tra gi√° m·ªói 1 ph√∫t, trigger alert khi ƒë·∫°t ƒëi·ªÅu ki·ªán

**Database:** MongoDB - Collections `notifications`, `pricealerts`

**C√¥ng ngh·ªá:** Express.js, Mongoose, node-cron

---

## 3.3. Trade Orchestration (Chi ti·∫øt)

**M·ª•c ƒë√≠ch:** ƒêi·ªÅu ph·ªëi nhi·ªÅu services ƒë·ªÉ th·ª±c hi·ªán m·ªôt giao d·ªãch ho√†n ch·ªânh.

### 3.3.1. Lu·ªìng mua coin (Buy Flow)

```
B∆Ø·ªöC 1: L·∫•y gi√° hi·ªán t·∫°i t·ª´ Market Service
        ‚Üí T√≠nh to√°n: totalCost = amount √ó price
        ‚Üí T√≠nh ph√≠: fee = totalCost √ó 0.1%
        ‚Üí finalCost = totalCost + fee

B∆Ø·ªöC 2: Ki·ªÉm tra s·ªë d∆∞ t·ª´ User Service
        ‚Üí N·∫øu balance < finalCost ‚Üí B√°o l·ªói

B∆Ø·ªöC 3: Tr·ª´ s·ªë d∆∞ (User Service)
        ‚Üí balance = balance - finalCost
        ‚Üí L∆∞u transactionState.balanceDeducted = true

B∆Ø·ªöC 4: Th√™m v√†o portfolio (Portfolio Service)
        ‚Üí N·∫øu ƒë√£ c√≥ coin: t√≠nh DCA
        ‚Üí N·∫øu ch∆∞a c√≥: t·∫°o m·ªõi
        ‚Üí L∆∞u transactionState.holdingAdded = true

B∆Ø·ªöC 5: Ghi l·ªãch s·ª≠ (Trade Service)
        ‚Üí T·∫°o trade record

B∆Ø·ªöC 6: G·ª≠i th√¥ng b√°o (Notification Service)
        ‚Üí T·∫°o notification "Mua th√†nh c√¥ng"

B∆Ø·ªöC 7: Ph√°t WebSocket event
        ‚Üí Emit 'trade_confirmation' cho user

N·∫æU L·ªñI: ROLLBACK
        ‚Üí N·∫øu holdingAdded: X√≥a holding
        ‚Üí N·∫øu balanceDeducted: Ho√†n ti·ªÅn
```

**Sequence Diagram - Buy Flow:**

```mermaid
sequenceDiagram
    participant C as Client
    participant GW as API Gateway
    participant MS as Market Service
    participant US as User Service
    participant PS as Portfolio Service
    participant TS as Trade Service
    participant NS as Notification Service

    C->>GW: POST /trade/buy {symbol, amount}
    GW->>MS: GET /price/:coinId
    MS-->>GW: {price, name}
    
    Note over GW: T√≠nh: totalCost = amount √ó price<br/>fee = 0.1%, finalCost = totalCost + fee

    GW->>US: GET /balance
    US-->>GW: {balance}
    
    alt balance < finalCost
        GW-->>C: ‚ùå Kh√¥ng ƒë·ªß s·ªë d∆∞
    else balance >= finalCost
        GW->>US: PUT /balance (tr·ª´ ti·ªÅn)
        US-->>GW: ‚úì Balance updated
        
        GW->>PS: POST /holding (th√™m coin)
        PS-->>GW: ‚úì Holding added
        
        GW->>TS: POST / (ghi l·ªãch s·ª≠)
        TS-->>GW: ‚úì Trade recorded
        
        GW->>NS: POST /send (th√¥ng b√°o)
        NS-->>GW: ‚úì Notification sent
        
        GW-->>C: ‚úÖ Mua th√†nh c√¥ng
    end
```

### 3.3.2. Lu·ªìng b√°n coin (Sell Flow)

```
B∆Ø·ªöC 1: Ki·ªÉm tra portfolio (Portfolio Service)
        ‚Üí N·∫øu kh√¥ng ƒë·ªß coin ‚Üí B√°o l·ªói

B∆Ø·ªöC 2: L·∫•y gi√° hi·ªán t·∫°i t·ª´ Market Service
        ‚Üí T√≠nh to√°n: totalValue = amount √ó price
        ‚Üí T√≠nh ph√≠: fee = totalValue √ó 0.1%
        ‚Üí finalProceeds = totalValue - fee

B∆Ø·ªöC 3: L·∫•y s·ªë d∆∞ hi·ªán t·∫°i (User Service)

B∆Ø·ªöC 4: C·ªông s·ªë d∆∞ (User Service)
        ‚Üí balance = balance + finalProceeds
        ‚Üí L∆∞u transactionState.balanceAdded = true

B∆Ø·ªöC 5: Gi·∫£m holdings (Portfolio Service)
        ‚Üí N·∫øu b√°n h·∫øt: x√≥a holding
        ‚Üí N·∫øu b√°n m·ªôt ph·∫ßn: gi·∫£m amount
        ‚Üí L∆∞u transactionState.holdingReduced = true

B∆Ø·ªöC 6: Ghi l·ªãch s·ª≠ (Trade Service)

B∆Ø·ªöC 7: G·ª≠i th√¥ng b√°o + WebSocket

N·∫æU L·ªñI: ROLLBACK
        ‚Üí N·∫øu holdingReduced: Ho√†n l·∫°i holding
        ‚Üí N·∫øu balanceAdded: Tr·ª´ s·ªë d∆∞
```

**Sequence Diagram - Sell Flow:**

```mermaid
sequenceDiagram
    participant C as Client
    participant GW as API Gateway
    participant PS as Portfolio Service
    participant MS as Market Service
    participant US as User Service
    participant TS as Trade Service
    participant NS as Notification Service

    C->>GW: POST /trade/sell {symbol, amount}
    GW->>PS: GET / (ki·ªÉm tra holdings)
    PS-->>GW: {holdings}
    
    alt Kh√¥ng ƒë·ªß coin
        GW-->>C: ‚ùå Kh√¥ng ƒë·ªß coin ƒë·ªÉ b√°n
    else ƒê·ªß coin
        GW->>MS: GET /price/:coinId
        MS-->>GW: {price}
        
        Note over GW: T√≠nh: totalValue = amount √ó price<br/>fee = 0.1%, finalProceeds = totalValue - fee

        GW->>US: PUT /balance (c·ªông ti·ªÅn)
        US-->>GW: ‚úì Balance updated
        
        GW->>PS: PUT /holding (gi·∫£m coin)
        PS-->>GW: ‚úì Holding reduced
        
        GW->>TS: POST / (ghi l·ªãch s·ª≠)
        TS-->>GW: ‚úì Trade recorded
        
        GW->>NS: POST /send (th√¥ng b√°o)
        NS-->>GW: ‚úì Notification sent
        
        GW-->>C: ‚úÖ B√°n th√†nh c√¥ng
    end
```

---

## 3.4. Bi·ªÉu ƒë·ªì lu·ªìng d·ªØ li·ªáu

### 3.4.1. Lu·ªìng x√°c th·ª±c (Authentication Flow)

```mermaid
sequenceDiagram
    participant C as Client
    participant GW as API Gateway
    participant US as User Service

    C->>GW: 1. POST /login {email, password}
    GW->>US: 2. Chuy·ªÉn ti·∫øp ƒë·∫øn User Service
    US->>US: 3. X√°c th·ª±c m·∫≠t kh·∫©u, t·∫°o JWT
    US-->>GW: 4. Tr·∫£ v·ªÅ {token, user}
    GW-->>C: ‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng
```

**C√°c b∆∞·ªõc:**
1. Client g·ª≠i email v√† password ƒë·∫øn API Gateway
2. API Gateway chuy·ªÉn ti·∫øp request ƒë·∫øn User Service
3. User Service x√°c th·ª±c m·∫≠t kh·∫©u (bcrypt) v√† t·∫°o JWT token (7 ng√†y)
4. Tr·∫£ v·ªÅ token v√† th√¥ng tin user cho client

**DFD Level 0 - Authentication:**

```mermaid
flowchart LR
    U((User)) -->|email, password| P1[1.0<br/>X√°c th·ª±c]
    P1 -->|truy v·∫•n| D1[(users)]
    D1 -->|d·ªØ li·ªáu user| P1
    P1 -->|JWT token + user info| U
```

### 3.4.2. Lu·ªìng xem portfolio (Portfolio Flow)

```mermaid
sequenceDiagram
    participant C as Client
    participant GW as API Gateway
    participant PS as Portfolio Service
    participant MS as Market Service

    C->>GW: 1. GET /portfolio
    GW->>PS: 2. L·∫•y holdings t·ª´ Portfolio Service
    PS-->>GW: 3. Tr·∫£ v·ªÅ danh s√°ch holdings
    GW->>MS: 4. L·∫•y gi√° hi·ªán t·∫°i cho t·ª´ng coin
    MS-->>GW: 5. Tr·∫£ v·ªÅ gi√°
    GW->>GW: T√≠nh to√°n P&L
    GW-->>C: 6. Tr·∫£ v·ªÅ portfolio v·ªõi l√£i/l·ªó
```

**C√°c b∆∞·ªõc:**
1. Client g·ª≠i request l·∫•y portfolio
2. API Gateway g·ªçi Portfolio Service ƒë·ªÉ l·∫•y danh s√°ch holdings
3. Portfolio Service tr·∫£ v·ªÅ holdings (coin, s·ªë l∆∞·ª£ng, gi√° mua trung b√¨nh)
4. API Gateway g·ªçi Market Service ƒë·ªÉ l·∫•y gi√° hi·ªán t·∫°i cho t·ª´ng coin
5. Market Service tr·∫£ v·ªÅ gi√° t·ª´ CoinGecko/CoinPaprika
6. API Gateway t√≠nh to√°n P&L v√† tr·∫£ v·ªÅ portfolio ƒë√£ ƒë∆∞·ª£c l√†m gi√†u (enriched)

**DFD Level 0 - Portfolio:**

```mermaid
flowchart LR
    U((User)) -->|request| P1[1.0<br/>L·∫•y Portfolio]
    P1 -->|truy v·∫•n holdings| D1[(portfolios)]
    D1 -->|holdings| P1
    P1 -->|l·∫•y gi√°| P2[2.0<br/>L·∫•y gi√°]
    P2 -->|g·ªçi API| E1[CoinGecko]
    E1 -->|gi√°| P2
    P2 -->|gi√°| P1
    P1 -->|portfolio + l√£i/l·ªó| U
```

### 3.4.3. Lu·ªìng giao d·ªãch (Trade Flow)

**DFD Level 1 - Trade Flow (Buy):**

```mermaid
flowchart TB
    U((User)) -->|symbol, amount| P1[1.0 L·∫•y gi√°]
    P1 -->|coinId| E1[CoinGecko]
    E1 -->|price| P1
    P1 -->|price| P2[2.0 Ki·ªÉm tra s·ªë d∆∞]
    P2 -->|userId| D1[(users)]
    D1 -->|balance| P2
    P2 -->|OK| P3[3.0 Tr·ª´ s·ªë d∆∞]
    P3 -->|update| D1
    P3 -->|done| P4[4.0 Th√™m holding]
    P4 -->|insert/update| D2[(portfolios)]
    P4 -->|done| P5[5.0 Ghi l·ªãch s·ª≠]
    P5 -->|insert| D3[(trades)]
    P5 -->|done| P6[6.0 G·ª≠i th√¥ng b√°o]
    P6 -->|insert| D4[(notifications)]
    P6 -->|result| U
```

---

## 3.5. C√°c patterns v√† k·ªπ thu·∫≠t n√¢ng cao

H·ªá th·ªëng √°p d·ª•ng nhi·ªÅu patterns v√† k·ªπ thu·∫≠t n√¢ng cao ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh ·ªïn ƒë·ªãnh, b·∫£o m·∫≠t v√† hi·ªáu nƒÉng.

### 3.5.1. Rate Limiting

**M·ª•c ƒë√≠ch:** B·∫£o v·ªá h·ªá th·ªëng kh·ªèi DDoS v√† abuse.

**C·∫•u h√¨nh:**
- **Global:** 1000 requests / 15 ph√∫t cho t·∫•t c·∫£ APIs
- Tr·∫£ v·ªÅ HTTP 429 khi v∆∞·ª£t gi·ªõi h·∫°n

**C√¥ng ngh·ªá:** express-rate-limit

```mermaid
flowchart LR
    Client -->|Request| RL{Rate Limiter}
    RL -->|Accepted| API[API Gateway]
    RL -->|Rejected 429| Error[Too Many Requests]
```

---

### 3.5.2. Circuit Breaker Pattern

**M·ª•c ƒë√≠ch:** NgƒÉn ch·∫∑n cascading failures khi m·ªôt service g·∫∑p s·ª± c·ªë.

**C∆° ch·∫ø ho·∫°t ƒë·ªông:**
- **Closed:** Ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng
- **Open:** Service l·ªói ‚Üí ng·∫Øt k·∫øt n·ªëi, tr·∫£ l·ªói ngay
- **Half-Open:** Th·ª≠ l·∫°i sau m·ªôt kho·∫£ng th·ªùi gian

**C√¥ng ngh·ªá:** Opossum

```mermaid
stateDiagram-v2
    [*] --> Closed
    Closed --> Open : Failures >= threshold
    Open --> HalfOpen : Timeout elapsed
    HalfOpen --> Closed : Success
    HalfOpen --> Open : Failure
```

---

### 3.5.3. Orchestration Pattern

**M·ª•c ƒë√≠ch:** ƒêi·ªÅu ph·ªëi nhi·ªÅu services ƒë·ªÉ ho√†n th√†nh m·ªôt giao d·ªãch ph·ª©c t·∫°p.

**ƒê·∫∑c ƒëi·ªÉm:**
- API Gateway ƒë√≥ng vai tr√≤ **Orchestrator**
- Giao d·ªãch Buy/Sell c√≥ **7 b∆∞·ªõc** tu·∫ßn t·ª±
- C√≥ c∆° ch·∫ø **ROLLBACK** khi m·ªôt b∆∞·ªõc th·∫•t b·∫°i

```mermaid
flowchart TD
    A[Start Buy] --> B[Step 1: Get Price]
    B --> C[Step 2: Check Balance]
    C --> D{ƒê·ªß ti·ªÅn?}
    D -->|Kh√¥ng| E[Return Error]
    D -->|C√≥| F[Step 3: Deduct Balance]
    F --> G[Step 4: Add Holding]
    G --> H[Step 5: Create Trade]
    H --> I[Step 6: Send Notification]
    I --> J[Step 7: WebSocket Event]
    J --> K[Success]
    
    F -.->|Error| R1[ROLLBACK: Refund]
    G -.->|Error| R2[ROLLBACK: Remove Holding + Refund]
```

---

### 3.5.4. WebSocket Real-time

**M·ª•c ƒë√≠ch:** Push notifications ƒë·∫øn client m√† kh√¥ng c·∫ßn polling.

**Events ƒë∆∞·ª£c h·ªó tr·ª£:**

| Event | M√¥ t·∫£ |
|-------|-------|
| `trade_confirmation` | Th√¥ng b√°o giao d·ªãch th√†nh c√¥ng |
| `price_alert` | C·∫£nh b√°o gi√° ƒë·∫°t m·ª•c ti√™u |
| `balance_update` | S·ªë d∆∞ thay ƒë·ªïi |
| `notification` | Th√¥ng b√°o m·ªõi |

**C√¥ng ngh·ªá:** Socket.IO

---

### 3.5.5. Fallback API Pattern

**M·ª•c ƒë√≠ch:** ƒê·∫£m b·∫£o h·ªá th·ªëng v·∫´n ho·∫°t ƒë·ªông khi API ch√≠nh g·∫∑p s·ª± c·ªë.

**C·∫•u h√¨nh:**
- **Primary:** CoinGecko API
- **Fallback:** CoinPaprika API

```mermaid
flowchart TD
    A[Market Service c·∫ßn gi√°] --> B{CoinGecko API}
    B -->|Success| C[Tr·∫£ v·ªÅ gi√°]
    B -->|Error/Timeout| D{CoinPaprika API}
    D -->|Success| C
    D -->|Error| E[Return cached data / Error]
```

---

### 3.5.6. DCA Calculation (Dollar Cost Averaging)

**M·ª•c ƒë√≠ch:** T√≠nh gi√° mua trung b√¨nh khi user mua nhi·ªÅu l·∫ßn c√πng m·ªôt coin.

**C√¥ng th·ª©c:**

```
newTotalInvested = oldTotalInvested + newInvestment
newTotalAmount = oldAmount + newAmount
newAverageBuyPrice = newTotalInvested / newTotalAmount
```

**V√≠ d·ª•:**
- L·∫ßn 1: Mua 0.001 BTC gi√° $70,000 ‚Üí averageBuyPrice = $70,000
- L·∫ßn 2: Mua 0.001 BTC gi√° $80,000 ‚Üí averageBuyPrice = (70+80)/2 = $75,000

---


# 4. PH√ÇN T√çCH V√Ä THI·∫æT K·∫æ D·ªÆ LI·ªÜU

## 4.1. M√¥ h√¨nh th·ª±c th·ªÉ li√™n k·∫øt (ERD)

### 4.1.1. User Service - Entity: User

```mermaid
erDiagram
    USER {
        ObjectId _id PK
        String email UK
        String password
        String fullName
        Enum role
        Number balance
        Boolean isActive
        Array balanceHistory
        Date createdAt
        Date updatedAt
    }
```

**Thu·ªôc t√≠nh:**

| Thu·ªôc t√≠nh | Ki·ªÉu | R√†ng bu·ªôc | M√¥ t·∫£ |
|------------|------|-----------|-------|
| _id | ObjectId | PK | Kh√≥a ch√≠nh |
| email | String | Unique, Required | Email ƒëƒÉng nh·∫≠p |
| password | String | Required | M·∫≠t kh·∫©u ƒë√£ m√£ h√≥a |
| fullName | String | Required | H·ªç t√™n ƒë·∫ßy ƒë·ªß |
| role | Enum | Default: 'user' | Vai tr√≤: user/admin |
| balance | Number | Default: 1000 | S·ªë d∆∞ USDT |
| isActive | Boolean | Default: true | Tr·∫°ng th√°i t√†i kho·∫£n |
| balanceHistory | Array | - | L·ªãch s·ª≠ bi·∫øn ƒë·ªông s·ªë d∆∞ |
| createdAt | Date | Auto | Ng√†y t·∫°o |
| updatedAt | Date | Auto | Ng√†y c·∫≠p nh·∫≠t |

---

### 4.1.2. Portfolio Service - Entity: Portfolio

```mermaid
erDiagram
    PORTFOLIO {
        ObjectId _id PK
        ObjectId userId FK
        Array holdings
        Number totalValue
        Number totalInvested
        Number totalProfit
        Number profitPercentage
        Date lastCalculated
    }
    HOLDING {
        String symbol
        String coinId
        String name
        Number amount
        Number averageBuyPrice
        Number totalInvested
        Date lastUpdated
    }
    PORTFOLIO ||--o{ HOLDING : contains
```

**Thu·ªôc t√≠nh:**

| Thu·ªôc t√≠nh | Ki·ªÉu | R√†ng bu·ªôc | M√¥ t·∫£ |
|------------|------|-----------|-------|
| _id | ObjectId | PK | Kh√≥a ch√≠nh |
| userId | ObjectId | FK, Unique | Li√™n k·∫øt ƒë·∫øn User |
| holdings | Array | - | Danh s√°ch coin s·ªü h·ªØu |
| totalValue | Number | Default: 0 | T·ªïng gi√° tr·ªã portfolio |
| totalInvested | Number | Default: 0 | T·ªïng chi ph√≠ ƒë·∫ßu t∆∞ |
| totalProfit | Number | Default: 0 | T·ªïng l√£i/l·ªó |
| profitPercentage | Number | Default: 0 | Ph·∫ßn trƒÉm l√£i/l·ªó |
| lastCalculated | Date | Default: now | Th·ªùi ƒëi·ªÉm t√≠nh to√°n cu·ªëi |

**C·∫•u tr√∫c Holding:**

| Thu·ªôc t√≠nh | Ki·ªÉu | M√¥ t·∫£ |
|------------|------|-------|
| symbol | String | K√Ω hi·ªáu coin (BTC, ETH) |
| coinId | String | ID coin (bitcoin, ethereum) |
| name | String | T√™n ƒë·∫ßy ƒë·ªß |
| amount | Number | S·ªë l∆∞·ª£ng coin |
| averageBuyPrice | Number | Gi√° mua trung b√¨nh |
| totalInvested | Number | T·ªïng chi ph√≠ |
| lastUpdated | Date | Th·ªùi ƒëi·ªÉm c·∫≠p nh·∫≠t cu·ªëi |

---

### 4.1.3. Trade Service - Entity: Trade

```mermaid
erDiagram
    TRADE {
        ObjectId _id PK
        ObjectId userId FK
        Enum type
        String symbol
        String coinId
        String coinName
        Number amount
        Number price
        Number totalCost
        Number fee
        Number feePercentage
        Enum status
        Number balanceBefore
        Number balanceAfter
        String notes
        String errorMessage
        Date executedAt
    }
```

**Thu·ªôc t√≠nh:**

| Thu·ªôc t√≠nh | Ki·ªÉu | R√†ng bu·ªôc | M√¥ t·∫£ |
|------------|------|-----------|-------|
| _id | ObjectId | PK | Kh√≥a ch√≠nh |
| userId | ObjectId | FK, Required | Li√™n k·∫øt ƒë·∫øn User |
| type | Enum | Required | Lo·∫°i: buy/sell |
| symbol | String | Required | K√Ω hi·ªáu coin |
| coinId | String | Required | ID coin |
| coinName | String | Required | T√™n coin |
| amount | Number | Required | S·ªë l∆∞·ª£ng |
| price | Number | Required | Gi√° t·∫°i th·ªùi ƒëi·ªÉm giao d·ªãch |
| totalCost | Number | Required | T·ªïng gi√° tr·ªã |
| fee | Number | Default: 0 | Ph√≠ giao d·ªãch |
| feePercentage | Number | Default: 0.1 | Ph·∫ßn trƒÉm ph√≠ |
| status | Enum | Default: 'completed' | Tr·∫°ng th√°i |
| balanceBefore | Number | Required | S·ªë d∆∞ tr∆∞·ªõc giao d·ªãch |
| balanceAfter | Number | Required | S·ªë d∆∞ sau giao d·ªãch |
| notes | String | maxlength: 500 | Ghi ch√∫ (optional) |
| errorMessage | String | - | Th√¥ng b√°o l·ªói (cho giao d·ªãch failed) |
| executedAt | Date | Default: now | Th·ªùi ƒëi·ªÉm th·ª±c hi·ªán |

---

### 4.1.4. Notification Service - Entities

```mermaid
erDiagram
    NOTIFICATION {
        ObjectId _id PK
        ObjectId userId FK
        Enum type
        String title
        String message
        Enum status
        Enum priority
        Enum channel
        Object data
        Date sentAt
        Date readAt
    }
    PRICEALERT {
        ObjectId _id PK
        ObjectId userId FK
        String symbol
        String coinId
        Number targetPrice
        Enum condition
        Boolean isActive
        Boolean triggered
        Date triggeredAt
        Date lastChecked
    }
```

**Entity 1: Notification**

| Thu·ªôc t√≠nh | Ki·ªÉu | M√¥ t·∫£ |
|------------|------|-------|
| _id | ObjectId | Kh√≥a ch√≠nh |
| userId | ObjectId | Li√™n k·∫øt ƒë·∫øn User |
| type | Enum | trade/price_alert/system/warning |
| title | String | Ti√™u ƒë·ªÅ th√¥ng b√°o |
| message | String | N·ªôi dung |
| status | Enum | unread/read/archived |
| priority | Enum | low/medium/high/urgent |
| channel | Enum | app (ch·ªâ th√¥ng b√°o trong app) |
| data | Object | D·ªØ li·ªáu b·ªï sung |
| sentAt | Date | Th·ªùi ƒëi·ªÉm g·ª≠i |
| readAt | Date | Th·ªùi ƒëi·ªÉm ƒë·ªçc |

**Entity 2: PriceAlert**

| Thu·ªôc t√≠nh | Ki·ªÉu | M√¥ t·∫£ |
|------------|------|-------|
| _id | ObjectId | Kh√≥a ch√≠nh |
| userId | ObjectId | Li√™n k·∫øt ƒë·∫øn User |
| symbol | String | K√Ω hi·ªáu coin |
| coinId | String | ID coin |
| targetPrice | Number | Gi√° m·ª•c ti√™u |
| condition | Enum | above/below |
| isActive | Boolean | C√≤n ho·∫°t ƒë·ªông kh√¥ng |
| triggered | Boolean | ƒê√£ trigger ch∆∞a |
| triggeredAt | Date | Th·ªùi ƒëi·ªÉm trigger |
| lastChecked | Date | L·∫ßn ki·ªÉm tra cu·ªëi |

---

## 4.2. M√¥ h√¨nh quan h·ªá

**S∆° ƒë·ªì quan h·ªá gi·ªØa c√°c collections:**

```mermaid
erDiagram
    USER ||--|| PORTFOLIO : has
    USER ||--o{ TRADE : makes
    USER ||--o{ NOTIFICATION : receives
    USER ||--o{ PRICEALERT : creates
    PORTFOLIO ||--o{ HOLDING : contains
    
    USER {
        ObjectId _id PK
        String email
        Number balance
    }
    PORTFOLIO {
        ObjectId _id PK
        ObjectId userId FK
    }
    HOLDING {
        String symbol
        String coinId
        Number amount
    }
    TRADE {
        ObjectId _id PK
        ObjectId userId FK
    }
    NOTIFICATION {
        ObjectId _id PK
        ObjectId userId FK
    }
    PRICEALERT {
        ObjectId _id PK
        ObjectId userId FK
    }
```

**M√¥ t·∫£ quan h·ªá:**

| Quan h·ªá | M√¥ t·∫£ |
|---------|-------|
| User ‚Üí Portfolio | 1:1 - M·ªói user c√≥ ƒë√∫ng 1 portfolio |
| User ‚Üí Trades | 1:N - M·ªói user c√≥ nhi·ªÅu giao d·ªãch |
| User ‚Üí Notifications | 1:N - M·ªói user c√≥ nhi·ªÅu th√¥ng b√°o |
| User ‚Üí PriceAlerts | 1:N - M·ªói user c√≥ nhi·ªÅu c·∫£nh b√°o |

---

## 4.3. B·∫£ng d·ªØ li·ªáu (Sample Data)

### B·∫£ng users

| _id | email | fullName | role | balance | isActive |
|-----|-------|----------|------|---------|----------|
| 64a1b2c3d4e5f6a7b8c9d0e1 | user@example.com | Nguy·ªÖn VƒÉn A | user | 850.50 | true |
| 64a1b2c3d4e5f6a7b8c9d0e2 | admin@example.com | Admin | admin | 1000.00 | true |

### B·∫£ng portfolios

| _id | userId | holdings | totalValue | totalInvested | totalProfit |
|-----|--------|----------|------------|---------------|-------------|
| 64a... | 64a1b2...d0e1 | [{symbol: "BTC", amount: 0.001, averageBuyPrice: 75000}] | 76.50 | 75.00 | 1.50 |

### B·∫£ng trades

| _id | userId | type | symbol | amount | price | totalCost | executedAt |
|-----|--------|------|--------|--------|-------|-----------|------------|
| 64a... | 64a1b2...d0e1 | buy | BTC | 0.001 | 75000 | 75.075 | 2024-01-01 10:30:00 |
| 64a... | 64a1b2...d0e1 | sell | ETH | 0.5 | 4200 | 2100 | 2024-01-02 14:15:00 |

---

# 5. GIAO DI·ªÜN C·ª¶A H·ªÜ TH·ªêNG

## 5.1. Giao di·ªán API cho t·ª´ng d·ªãch v·ª•

### 5.1.1. Chu·∫©n API Response

**Success Response:**
```json
{
  "success": true,
  "data": { ... },
  "message": "Thao t√°c th√†nh c√¥ng"
}
```

**Error Response:**
```json
{
  "success": false,
  "message": "M√¥ t·∫£ l·ªói",
  "error": "Chi ti·∫øt l·ªói (n·∫øu c√≥)"
}
```

### 5.1.2. Authentication Header

```
Authorization: Bearer <JWT_TOKEN>
```

### 5.1.3. Danh s√°ch API Endpoints

**BASE URL:** `http://localhost:3000/api`

**T·ªïng c·ªông: 30 REST API Endpoints (25 Client-facing + 5 Internal)**

#### Client-facing APIs (25 endpoints)

| Service | Method | Endpoint | Auth | M√¥ t·∫£ |
|---------|--------|----------|------|-------|
| **User** | POST | /users/register | ‚ùå | ƒêƒÉng k√Ω |
| | POST | /users/login | ‚ùå | ƒêƒÉng nh·∫≠p |
| | GET | /users/profile | ‚úÖ | L·∫•y profile |
| | PUT | /users/profile | ‚úÖ | C·∫≠p nh·∫≠t profile |
| | GET | /users/balance | ‚úÖ | L·∫•y s·ªë d∆∞ |
| **Market** | GET | /market/prices | ‚úÖ | Gi√° t·∫•t c·∫£ coins |
| | GET | /market/price/:coinId | ‚úÖ | Gi√° m·ªôt coin |
| | GET | /market/chart/:coinId | ‚úÖ | D·ªØ li·ªáu chart |
| **Trade** | POST | /trade/buy | ‚úÖ | Mua coin (Orchestration) |
| | POST | /trade/sell | ‚úÖ | B√°n coin (Orchestration) |
| | GET | /trade/history | ‚úÖ | L·ªãch s·ª≠ giao d·ªãch |
| **Portfolio** | GET | /portfolio | ‚úÖ | Xem portfolio |
| **Notification** | GET | /notifications | ‚úÖ | Danh s√°ch th√¥ng b√°o |
| | GET | /notifications/unread-count | ‚úÖ | S·ªë th√¥ng b√°o ch∆∞a ƒë·ªçc |
| | PUT | /notifications/:id/read | ‚úÖ | ƒê√°nh d·∫•u ƒë√£ ƒë·ªçc |
| | PUT | /notifications/read-all | ‚úÖ | ƒê√°nh d·∫•u t·∫•t c·∫£ ƒë√£ ƒë·ªçc |
| | DELETE | /notifications/:id | ‚úÖ | X√≥a th√¥ng b√°o |
| | POST | /notifications/alert | ‚úÖ | T·∫°o c·∫£nh b√°o gi√° |
| | GET | /notifications/alerts | ‚úÖ | Danh s√°ch alerts |
| | DELETE | /notifications/alert/:id | ‚úÖ | X√≥a alert |
| **Admin** | GET | /users/admin/users | ‚úÖ Admin | Danh s√°ch users |
| | GET | /users/admin/stats | ‚úÖ Admin | Th·ªëng k√™ h·ªá th·ªëng |
| | PUT | /users/admin/users/:id/toggle | ‚úÖ Admin | Kh√≥a/M·ªü user |
| | PUT | /users/admin/users/:id/balance | ‚úÖ Admin | C·∫≠p nh·∫≠t s·ªë d∆∞ |
| | DELETE | /users/admin/users/:id | ‚úÖ Admin | X√≥a user |

#### Internal APIs (5 endpoints - Service-to-service)

| Service | Method | Endpoint | M·ª•c ƒë√≠ch |
|---------|--------|----------|----------|
| User | PUT | /users/balance | C·∫≠p nh·∫≠t s·ªë d∆∞ t·ª´ orchestration |
| Portfolio | POST | /portfolio/holding | Th√™m coin khi mua |
| Portfolio | PUT | /portfolio/holding | Gi·∫£m coin khi b√°n |
| Trade | POST | /trade | T·∫°o trade record |
| Notification | POST | /notifications/send | G·ª≠i notification |

### 5.1.4. Chi ti·∫øt API Request/Response

**POST /users/login**

Request:
```json
{
  "email": "user@example.com",
  "password": "123456"
}
```

Response (200):
```json
{
  "success": true,
  "message": "Login successful",
  "data": {
    "user": {
      "id": "64a1b2c3d4e5f6a7b8c9d0e1",
      "email": "user@example.com",
      "fullName": "Nguy·ªÖn VƒÉn A",
      "balance": 1000,
      "role": "user"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

**POST /trade/buy**

Request:
```json
{
  "symbol": "BTC",
  "coinId": "bitcoin",
  "amount": 0.001
}
```

Response (200):
```json
{
  "success": true,
  "data": {
    "trade": {
      "_id": "64a...",
      "type": "buy",
      "symbol": "BTC",
      "amount": 0.001,
      "price": 75000,
      "totalCost": 75.075,
      "fee": 0.075,
      "status": "completed"
    },
    "newBalance": 924.925
  },
  "message": "Mua BTC th√†nh c√¥ng"
}
```

---

## 5.2. Giao di·ªán ng∆∞·ªùi d√πng (Web)

**C√¥ng ngh·ªá s·ª≠ d·ª•ng:**
- **Framework:** React 18 + Vite
- **Styling:** TailwindCSS
- **Charts:** Recharts
- **Icons:** Lucide React
- **HTTP Client:** Axios
- **Real-time:** Socket.IO Client

### 5.2.1. Danh s√°ch m√†n h√¨nh

| STT | Trang | Route | M√¥ t·∫£ |
|-----|-------|-------|-------|
| 1 | ƒêƒÉng nh·∫≠p/ƒêƒÉng k√Ω | /auth | Form login/register |
| 2 | Dashboard | /dashboard | T·ªïng quan, gi√° coins |
| 3 | Giao d·ªãch | /trade | Form mua/b√°n coin |
| 4 | Chi ti·∫øt Coin | /coin/:id | Th√¥ng tin v√† chart |
| 5 | Portfolio | /portfolio | Danh m·ª•c ƒë·∫ßu t∆∞ |
| 6 | L·ªãch s·ª≠ | /history | L·ªãch s·ª≠ giao d·ªãch |
| 7 | Th√¥ng b√°o | /notifications | Danh s√°ch th√¥ng b√°o |
| 8 | C√†i ƒë·∫∑t | /settings | Profile, c·∫£nh b√°o gi√° |
| 9 | Admin | /admin | Qu·∫£n l√Ω users (Admin) |

### 5.2.2. Wireframe/Mockup

**[CH·ª™A TR·ªêNG - Ch√®n screenshot ho·∫∑c mockup c√°c m√†n h√¨nh]**

**1. M√†n h√¨nh Auth (ƒêƒÉng nh·∫≠p/ƒêƒÉng k√Ω):**
- Form ƒëƒÉng k√Ω v·ªõi email, password, fullName
- Form ƒëƒÉng nh·∫≠p v·ªõi email, password
- Chuy·ªÉn ƒë·ªïi gi·ªØa Login/Register
- Validation l·ªói hi·ªÉn th·ªã r√µ r√†ng

**2. M√†n h√¨nh Dashboard:**
- Hi·ªÉn th·ªã s·ªë d∆∞ hi·ªán t·∫°i
- B·∫£ng gi√° coins real-time
- T√≥m t·∫Øt portfolio (t·ªïng gi√° tr·ªã, l√£i/l·ªó)
- Chart so s√°nh gi√° top 5 coins

**3. M√†n h√¨nh Trade:**
- Danh s√°ch coins c√≥ t√¨m ki·∫øm
- Tab Buy/Sell chuy·ªÉn ƒë·ªïi
- Nh·∫≠p s·ªë ti·ªÅn USDT ho·∫∑c s·ªë l∆∞·ª£ng coin
- Preview t·ªïng chi ph√≠, ph√≠ (0.1%), s·ªë d∆∞ sau giao d·ªãch

**4. M√†n h√¨nh Chi ti·∫øt Coin:**
- Th√¥ng tin coin (t√™n, symbol, gi√°, market cap)
- Bi·ªÉu ƒë·ªì gi√° 7 ng√†y
- Bi·∫øn ƒë·ªông 24h (tƒÉng/gi·∫£m %)
- N√∫t Trade nhanh

**5. M√†n h√¨nh Portfolio:**
- Bi·ªÉu ƒë·ªì tr√≤n ph√¢n b·ªï holdings
- B·∫£ng holdings v·ªõi gi√° hi·ªán t·∫°i, P&L
- T·ªïng l√£i/l·ªó, % l√£i/l·ªó

**6. M√†n h√¨nh History (L·ªãch s·ª≠):**
- B·∫£ng l·ªãch s·ª≠ giao d·ªãch (Buy/Sell)
- Filter theo lo·∫°i, symbol, th·ªùi gian
- Ph√¢n trang
- Chi ti·∫øt: amount, price, fee, status

**7. M√†n h√¨nh Notifications:**
- Danh s√°ch th√¥ng b√°o
- Badge s·ªë ch∆∞a ƒë·ªçc
- ƒê√°nh d·∫•u ƒë√£ ƒë·ªçc (1 ho·∫∑c t·∫•t c·∫£)
- X√≥a th√¥ng b√°o

**8. M√†n h√¨nh Settings:**
- Th√¥ng tin profile (email, fullName)
- Qu·∫£n l√Ω c·∫£nh b√°o gi√° (t·∫°o, xem, x√≥a)
- L·ªãch s·ª≠ s·ªë d∆∞ (balanceHistory)

**9. M√†n h√¨nh Admin:**
- Danh s√°ch users v·ªõi t√¨m ki·∫øm
- Th·ªëng k√™ h·ªá th·ªëng (t·ªïng users, t·ªïng balance)
- Kh√≥a/M·ªü kh√≥a user
- ƒêi·ªÅu ch·ªânh s·ªë d∆∞ user
- X√≥a user

---

# 6. K·∫æT LU·∫¨N

## 6.1. K·∫øt qu·∫£ ƒë·∫°t ƒë∆∞·ª£c

### V·ªÅ m·∫∑t ki·∫øn tr√∫c:

1. **√Åp d·ª•ng th√†nh c√¥ng ki·∫øn tr√∫c SOA:** H·ªá th·ªëng ƒë∆∞·ª£c chia th√†nh 5 services ƒë·ªôc l·∫≠p s·ª≠ d·ª•ng chung database, m·ªói service c√≥ tr√°ch nhi·ªám r√µ r√†ng v√† c√≥ th·ªÉ ph√°t tri·ªÉn, tri·ªÉn khai ri√™ng bi·ªát.

2. **API Gateway Pattern:** Tri·ªÉn khai m·ªôt ƒëi·ªÉm v√†o duy nh·∫•t gi√∫p ƒë∆°n gi·∫£n h√≥a vi·ªác giao ti·∫øp gi·ªØa client v√† c√°c services, ƒë·ªìng th·ªùi t·∫≠p trung x·ª≠ l√Ω cross-cutting concerns (authentication, rate limiting).

3. **Orchestration Pattern:** S·ª≠ d·ª•ng orchestrator t·∫°i API Gateway ƒë·ªÉ ƒëi·ªÅu ph·ªëi c√°c giao d·ªãch ph·ª©c t·∫°p c·∫ßn nhi·ªÅu services, ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn d·ªØ li·ªáu.

4. **Circuit Breaker Pattern:** T√≠ch h·ª£p Opossum ƒë·ªÉ ngƒÉn ch·∫∑n cascading failures khi m·ªôt service g·∫∑p s·ª± c·ªë.

5. **Service Discovery:** S·ª≠ d·ª•ng Consul cho vi·ªác ƒëƒÉng k√Ω v√† kh√°m ph√° services ƒë·ªông.

### V·ªÅ m·∫∑t ch·ª©c nƒÉng:

1. **Ho√†n th√†nh 30 REST API endpoints** ph·ª•c v·ª• ƒë·∫ßy ƒë·ªß c√°c ch·ª©c nƒÉng nghi·ªáp v·ª•.

2. **Real-time communication** v·ªõi 4 WebSocket events cho giao d·ªãch v√† th√¥ng b√°o.

3. **Giao di·ªán ng∆∞·ªùi d√πng** tr·ª±c quan v·ªõi 9 trang ch·ª©c nƒÉng.

4. **H·ªá th·ªëng Admin** cho ph√©p qu·∫£n l√Ω ng∆∞·ªùi d√πng.

## 6.2. ∆Øu ƒëi·ªÉm c·ªßa ki·∫øn tr√∫c SOA √°p d·ª•ng

| ∆Øu ƒëi·ªÉm | M√¥ t·∫£ |
|---------|-------|
| **Loose Coupling** | C√°c services ƒë·ªôc l·∫≠p, thay ƒë·ªïi m·ªôt service kh√¥ng ·∫£nh h∆∞·ªüng ƒë·∫øn service kh√°c |
| **Scalability** | C√≥ th·ªÉ scale t·ª´ng service ri√™ng bi·ªát theo nhu c·∫ßu |
| **Fault Isolation** | L·ªói ·ªü m·ªôt service kh√¥ng l√†m s·∫≠p to√†n h·ªá th·ªëng |
| **Technology Diversity** | M·ªói service c√≥ th·ªÉ s·ª≠ d·ª•ng c√¥ng ngh·ªá ph√π h·ª£p |
| **Team Independence** | C√°c team c√≥ th·ªÉ ph√°t tri·ªÉn song song |
| **Reusability** | Services c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng cho c√°c ·ª©ng d·ª•ng kh√°c |

## 6.3. H·∫°n ch·∫ø v√† h∆∞·ªõng ph√°t tri·ªÉn

### H·∫°n ch·∫ø:

1. **Complexity:** Ki·∫øn tr√∫c SOA ph·ª©c t·∫°p h∆°n monolithic, ƒë√≤i h·ªèi ki·∫øn th·ª©c v·ªÅ distributed systems.

2. **Network Latency:** Giao ti·∫øp gi·ªØa c√°c services qua HTTP c√≥ ƒë·ªô tr·ªÖ cao h∆°n in-process calls.

3. **Data Consistency:** V·ªõi c√°c services s·ª≠ d·ª•ng chung database, c·∫ßn ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n d·ªØ li·ªáu khi c√≥ nhi·ªÅu transactions.

4. **Monitoring:** C·∫ßn c√¥ng c·ª• logging v√† monitoring t·∫≠p trung ƒë·ªÉ theo d√µi h·ªá th·ªëng.

### H∆∞·ªõng ph√°t tri·ªÉn:

1. **Event-Driven Architecture:** S·ª≠ d·ª•ng message queue (RabbitMQ, Kafka) thay v√¨ HTTP calls ƒë·ªÉ tƒÉng t√≠nh resilience.

2. **Kubernetes Deployment:** Containerize services v·ªõi Docker v√† orchestrate b·∫±ng Kubernetes.

3. **Centralized Logging:** T√≠ch h·ª£p ELK Stack (Elasticsearch, Logstash, Kibana) cho logging.

4. **API Documentation:** S·ª≠ d·ª•ng Swagger/OpenAPI cho documentation t·ª± ƒë·ªông.

5. **Testing:** B·ªï sung unit tests, integration tests v√† contract tests.

6. **Security:** Implement OAuth 2.0, HTTPS, v√† API key management.

## 6.4. B√†i h·ªçc kinh nghi·ªám

1. **Design API tr∆∞·ªõc:** Thi·∫øt k·∫ø API contract tr∆∞·ªõc khi implement gi√∫p c√°c services ph√°t tri·ªÉn song song.

2. **Circuit Breaker l√† b·∫Øt bu·ªôc:** Trong distributed system, ph·∫£i c√≥ c∆° ch·∫ø x·ª≠ l√Ω khi service downstream fail.

3. **Logging l√† quan tr·ªçng:** Kh√¥ng c√≥ logs t·∫≠p trung, debug c√°c services r·∫•t kh√≥ khƒÉn.

4. **Rollback mechanism:** V·ªõi c√°c transaction li√™n quan nhi·ªÅu services, c·∫ßn c√≥ chi·∫øn l∆∞·ª£c rollback r√µ r√†ng.

5. **Cache gi√∫p gi·∫£m t·∫£i:** Caching ·ªü Market Service gi√∫p gi·∫£m ƒë√°ng k·ªÉ API calls ƒë·∫øn CoinGecko.

---

# PH·ª§ L·ª§C

## A. C√¥ng ngh·ªá s·ª≠ d·ª•ng

| Layer | C√¥ng ngh·ªá |
|-------|-----------|
| **Frontend** | React 18, Vite, TailwindCSS, Recharts, Axios, Socket.IO Client |
| **API Gateway** | Express.js, http-proxy-middleware, Socket.IO |
| **Backend Services** | Node.js, Express.js, Mongoose |
| **Database** | MongoDB |
| **Authentication** | JWT, bcryptjs |
| **External APIs** | CoinGecko, CoinPaprika |
| **Patterns** | Circuit Breaker (Opossum), Service Discovery (Consul) |

## B. C·∫•u tr√∫c th∆∞ m·ª•c

```
CryptoTradingSOA/
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ pages/          # 9 trang
‚îÇ       ‚îú‚îÄ‚îÄ components/     # UI components
‚îÇ       ‚îú‚îÄ‚îÄ services/       # API, WebSocket
‚îÇ       ‚îî‚îÄ‚îÄ context/        # Auth context
‚îÇ
‚îî‚îÄ‚îÄ backend/
    ‚îú‚îÄ‚îÄ api-gateway/
    ‚îÇ   ‚îú‚îÄ‚îÄ server.js
    ‚îÇ   ‚îî‚îÄ‚îÄ orchestration/
    ‚îú‚îÄ‚îÄ services/
    ‚îÇ   ‚îú‚îÄ‚îÄ user-service/
    ‚îÇ   ‚îú‚îÄ‚îÄ market-service/
    ‚îÇ   ‚îú‚îÄ‚îÄ portfolio-service/
    ‚îÇ   ‚îú‚îÄ‚îÄ trade-service/
    ‚îÇ   ‚îî‚îÄ‚îÄ notification-service/
    ‚îî‚îÄ‚îÄ shared/
        ‚îú‚îÄ‚îÄ config/
        ‚îú‚îÄ‚îÄ middleware/
        ‚îî‚îÄ‚îÄ utils/
```

## C. H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t v√† ch·∫°y

```bash
# 1. Clone repository
git clone <repo-url>

# 2. C√†i ƒë·∫∑t dependencies
cd backend && npm install
cd ../frontend && npm install

# 3. T·∫°o file .env (copy t·ª´ .env.example)

# 4. Ch·∫°y MongoDB v√† Consul

# 5. Ch·∫°y backend
cd backend
.\start-all-services.ps1

# 6. Ch·∫°y frontend
cd frontend
npm run dev
```

---